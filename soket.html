<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linux Socket Flow Map</title>
  <script src="/js/cytoscape.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      display: flex;
      height: 100vh;
      background: #0a0a0a;
      color: #e5e5e5;
      overflow: hidden;
    }

    #cy {
      flex: 1;
      background: #111;
      position: relative;
    }

    #info {
      width: 350px;
      padding: 20px;
      background: #1a1a1a;
      border-left: 1px solid #333;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    #info h3 {
      margin: 0 0 8px 0;
      color: #7dd3fc;
      font-size: 18px;
      border-bottom: 2px solid #2563eb;
      padding-bottom: 8px;
    }

    #info p {
      margin: 8px 0;
      line-height: 1.6;
      color: #d1d5db;
    }

    #info .desc {
      color: #9ca3af;
      font-size: 14px;
    }

    #info .function-list {
      margin-top: 12px;
      padding-left: 20px;
    }

    #info .function-list li {
      margin: 6px 0;
      color: #60a5fa;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    #info .level-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      margin-right: 8px;
    }

    #controls {
      position: absolute;
      top: 80px;
      left: 20px;
      background: rgba(26, 26, 26, 0.9);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #333;
      z-index: 1000;
    }

    #controls h4 {
      margin: 0 0 8px 0;
      color: #7dd3fc;
      font-size: 14px;
    }

    #controls .control-item {
      margin: 4px 0;
      font-size: 12px;
      color: #9ca3af;
    }

    #zoom-level {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(26, 26, 26, 0.9);
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #333;
      z-index: 1000;
      font-size: 12px;
      color: #60a5fa;
    }

    #title {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(26, 26, 26, 0.95);
      padding: 12px 24px;
      border-radius: 8px;
      z-index: 1000;
      font-size: 20px;
      font-weight: bold;
      color: #7dd3fc;
      text-align: left;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    #title-tcp-state {
      position: absolute;
      background: rgba(26, 26, 26, 0.95);
      padding: 12px 24px;
      border-radius: 8px;
      z-index: 1000;
      font-size: 20px;
      font-weight: bold;
      color: #7dd3fc;
      text-align: left;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    .legend {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #333;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin: 8px 0;
      font-size: 12px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      margin-right: 8px;
    }
  </style>
</head>
<body>

<div id="cy"></div>

<div id="info">
  <h3>Socketì´ë€ ë¬´ì—‡ì¸ê°€</h3>
  <p class="desc" style="margin-bottom: 12px;">
    <a href="index.html" style="color: #60a5fa; text-decoration: none; font-weight: bold; border-bottom: 1px solid #60a5fa; display: block; margin-bottom: 8px;">ë„¤íŠ¸ì›Œí¬ ë§µ</a>
    <a href="tutorial.html" style="color: #60a5fa; text-decoration: none; font-weight: bold; border-bottom: 1px solid #60a5fa; display: block;">ë„¤íŠ¸ì›Œí¬ ë§µ ì‹¤ìŠµ íŠœí† ë¦¬ì–¼</a>
    <a href="soket.html" style="color: #60a5fa; text-decoration: none; font-weight: bold; border-bottom: 1px solid #60a5fa; display: block; margin-bottom: 8px;">ì†Œì¼“ ë§µ</a>
  </p>
  <p class="desc"><strong>í•µì‹¬ ë©”ì‹œì§€:</strong></p>
  <p class="desc">ì†Œì¼“ì€ í†µì‹ ìš© íŒŒì¼ì´ ì•„ë‹ˆë¼ ì»¤ë„ ìƒíƒœ ë¨¸ì‹ ì˜ í•¸ë“¤ì…ë‹ˆë‹¤.</p>
  <p class="desc" style="margin-top: 16px;"><strong>Chapter 1 ì£¼ìš” ë‚´ìš©:</strong></p>
  <ul class="function-list" style="margin-top: 8px;">
    <li>Socketì˜ ì—­ì‚¬ (BSD Socket â†’ Linux)</li>
    <li>ì™œ file descriptorì¸ê°€?</li>
    <li>socket vs file vs pipe vs epoll</li>
    <li>í”„ë¡œì„¸ìŠ¤ ê´€ì ì—ì„œ ë³¸ socket lifecycle</li>
  </ul>
  <p class="desc" style="margin-top: 16px;">ë…¸ë“œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
  <p class="desc">ë§ˆìš°ìŠ¤ íœ ë¡œ í™•ëŒ€/ì¶•ì†Œ, ë“œë˜ê·¸ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</div>

<div id="controls">
  <h4>Controls</h4>
  <div class="control-item">ğŸ–±ï¸ ë“œë˜ê·¸: ì´ë™</div>
  <div class="control-item">ğŸ–±ï¸ íœ : í™•ëŒ€/ì¶•ì†Œ</div>
  <div class="control-item">âŒ¨ï¸ ë°©í–¥í‚¤: ì´ë™</div>
  <div class="control-item">âŒ¨ï¸ +/-: í™•ëŒ€/ì¶•ì†Œ</div>
  <div class="control-item">âŒ¨ï¸ ESC: ì „ì²´ ë³´ê¸°</div>
</div>

<div id="zoom-level">Zoom: 1.00x</div>

<script>
// Socket ë§µ ë°ì´í„° - Chapter 1: Socketì´ë€ ë¬´ì—‡ì¸ê°€
const socketData = {
  nodes: [
    // Socketì˜ ì—­ì‚¬ (ìƒë‹¨ ì™¼ìª½)
    {
      id: 'bsd-socket',
      label: 'BSD Socket\n(1983)',
      level: 'HISTORY',
      desc: 'Berkeley Software Distribution Socket',
      detailedDesc: '1983ë…„ì— BSD 4.2ì—ì„œ ì²˜ìŒ ë„ì…ëœ Socket APIì…ë‹ˆë‹¤. Unix ê³„ì—´ ì‹œìŠ¤í…œì—ì„œ ë„¤íŠ¸ì›Œí¬ í”„ë¡œê·¸ë˜ë°ì„ ìœ„í•œ í‘œì¤€ ì¸í„°í˜ì´ìŠ¤ë¡œ ìë¦¬ì¡ì•˜ìŠµë‹ˆë‹¤.\n\níŠ¹ì§•:\n- "ëª¨ë“  ê²ƒì´ íŒŒì¼"ì´ë¼ëŠ” Unix ì² í•™ì„ ë„¤íŠ¸ì›Œí¬ì— ì ìš©\n- íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ë¥¼ í†µí•œ í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤\n- ë‹¤ì–‘í•œ í”„ë¡œí† ì½œ(IPv4, IPv6, Unix Domain ë“±) ì§€ì›',
      functions: ['socket()', 'bind()', 'connect()', 'accept()'],
      position: { x: -600, y: -350 }
    },
    {
      id: 'linux-socket',
      label: 'Linux Socket',
      level: 'CORE',
      desc: 'Linux ì»¤ë„ì˜ Socket êµ¬í˜„',
      detailedDesc: 'LinuxëŠ” BSD Socket APIë¥¼ í˜¸í™˜í•˜ë©´ì„œë„, ë‚´ë¶€ì ìœ¼ë¡œëŠ” ì™„ì „íˆ ë‹¤ë¥¸ êµ¬ì¡°ë¡œ êµ¬í˜„ë˜ì—ˆìŠµë‹ˆë‹¤.\n\nLinux Socketì˜ íŠ¹ì§•:\n- POSIX í˜¸í™˜ API ì œê³µ (BSD Socketê³¼ ë™ì¼í•œ ì¸í„°í˜ì´ìŠ¤)\n- ì»¤ë„ ë‚´ë¶€ëŠ” struct socketê³¼ struct sockìœ¼ë¡œ ë¶„ë¦¬\n- VFS(Virtual File System)ì™€ í†µí•©ë˜ì–´ íŒŒì¼ì²˜ëŸ¼ ë³´ì„\n- epoll, io_uring ë“± Linux ê³ ìœ ì˜ ê³ ì„±ëŠ¥ I/O ì§€ì›',
      functions: ['sys_socket()', 'sys_bind()', 'sys_listen()'],
      position: { x: -400, y: -350 }
    },
    
    // í•µì‹¬ ê°œë…: Socket (ìƒë‹¨ ì¤‘ì•™)
    {
      id: 'socket-core',
      label: 'Socket',
      level: 'CORE',
      desc: 'ì»¤ë„ ìƒíƒœ ë¨¸ì‹ ì˜ í•¸ë“¤ (File Descriptorì˜ í•œ ì¢…ë¥˜)',
      detailedDesc: 'Socketì€ File Descriptorì˜ í•œ ì¢…ë¥˜ë¡œ, ì»¤ë„ ë‚´ë¶€ì˜ ìƒíƒœ ë¨¸ì‹ (State Machine)ì„ ì œì–´í•˜ëŠ” í•¸ë“¤(Handle)ì…ë‹ˆë‹¤.\n\nì¤‘ìš”: Regular File, Pipeì™€ ê°™ì€ ë ˆë²¨ì˜ File Descriptor ì¢…ë¥˜ì…ë‹ˆë‹¤!\n- Regular File: ë””ìŠ¤í¬ íŒŒì¼ìš© File Descriptor\n- Pipe: í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ìš© File Descriptor\n- Socket: ë„¤íŠ¸ì›Œí¬ í†µì‹ ìš© File Descriptor\n- ì´ë“¤ì€ ëª¨ë‘ File Descriptorì´ì§€ë§Œ, ê°ê° ë‹¤ë¥¸ ëª©ì ê³¼ ë‚´ë¶€ êµ¬ì¡°ë¥¼ ê°€ì§‘ë‹ˆë‹¤\n\nSocketì˜ ì¢…ë¥˜ (Address Family):\n- AF_INET: IPv4 ë„¤íŠ¸ì›Œí¬ í†µì‹ ìš© Socket\n- AF_INET6: IPv6 ë„¤íŠ¸ì›Œí¬ í†µì‹ ìš© Socket\n- AF_UNIX (Unix Domain Socket): ê°™ì€ ë¨¸ì‹  ë‚´ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ìš© Socket\n  â†’ ì¤‘ìš”: Unix Domain Socketë„ Socketì…ë‹ˆë‹¤! Pipeê°€ ì•„ë‹™ë‹ˆë‹¤!\n  â†’ socket(AF_UNIX, ...)ë¡œ ìƒì„±í•˜ë©°, ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒì„ ê±°ì¹˜ì§€ ì•Šê³  ì»¤ë„ ë‚´ë¶€ì—ì„œ ì§ì ‘ í†µì‹ \n  â†’ Pipeì™€ì˜ ì°¨ì´: ì–‘ë°©í–¥ í†µì‹  ê°€ëŠ¥, ì„ì˜ì˜ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹  ê°€ëŠ¥, íŒŒì¼ ì‹œìŠ¤í…œ ê²½ë¡œë¡œ ì‹ë³„\n- AF_NETLINK: ì»¤ë„ê³¼ ì‚¬ìš©ì ê³µê°„ í†µì‹ ìš© Socket\n\ní•µì‹¬ ê°œë…:\n- File descriptorë¡œ í‘œí˜„ë˜ì§€ë§Œ ì‹¤ì œ íŒŒì¼ì´ ì•„ë‹˜\n- ì»¤ë„ ë‚´ë¶€ì˜ struct socketê³¼ struct sock êµ¬ì¡°ì²´ë¡œ ê´€ë¦¬\n- í†µì‹  ìƒíƒœ(ì—°ê²°, ì „ì†¡, ìˆ˜ì‹  ë“±)ë¥¼ ì¶”ì í•˜ëŠ” ìƒíƒœ ë¨¸ì‹ \n- í(receive queue, send queue)ë¥¼ í†µí•´ ë°ì´í„° ë²„í¼ë§\n\nSocketì˜ ë³¸ì§ˆ:\n"íŒŒì¼ì²˜ëŸ¼ ë³´ì´ì§€ë§Œ íŒŒì¼ì´ ì•„ë‹Œ ê²ƒ" - í”„ë¡œì„¸ìŠ¤ëŠ” íŒŒì¼ì²˜ëŸ¼ read/writeí•˜ì§€ë§Œ, ì»¤ë„ì€ ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œ ìŠ¤íƒì„ í†µí•´ ì‹¤ì œ í†µì‹ ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.',
      functions: ['socket()', 'struct socket', 'struct sock'],
      position: { x: 0, y: -350 }
    },
    
    // File Descriptor (ìƒë‹¨ ì˜¤ë¥¸ìª½)
    {
      id: 'file-descriptor',
      label: 'File Descriptor',
      level: 'KERNEL',
      desc: 'í”„ë¡œì„¸ìŠ¤ê°€ ì»¤ë„ ìì›ì„ ì°¸ì¡°í•˜ëŠ” í•¸ë“¤',
      detailedDesc: 'File DescriptorëŠ” í”„ë¡œì„¸ìŠ¤ê°€ ì»¤ë„ì˜ ìì›(íŒŒì¼, ì†Œì¼“, íŒŒì´í”„ ë“±)ì„ ì°¸ì¡°í•˜ëŠ” ì •ìˆ˜í˜• í•¸ë“¤ì…ë‹ˆë‹¤.\n\nì™œ Socketë„ File Descriptorì¸ê°€?\n- Unix ì² í•™: "ëª¨ë“  ê²ƒì´ íŒŒì¼"\n- VFS(Virtual File System) í†µí•©: Socketë„ VFSì˜ inodeë¡œ ê´€ë¦¬\n- í†µì¼ëœ ì¸í„°í˜ì´ìŠ¤: read(), write(), close() ë“± ë™ì¼í•œ í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥\n- í”„ë¡œì„¸ìŠ¤ë³„ fd tableë¡œ ê´€ë¦¬: ê° í”„ë¡œì„¸ìŠ¤ëŠ” ë…ë¦½ì ì¸ fd ê³µê°„ ë³´ìœ \n\ní•˜ì§€ë§Œ Socketì€ íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤:\n- ë””ìŠ¤í¬ì— ì €ì¥ë˜ì§€ ì•ŠìŒ\n- ì»¤ë„ ë©”ëª¨ë¦¬ì˜ êµ¬ì¡°ì²´ë¡œë§Œ ì¡´ì¬\n- ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œ ìŠ¤íƒê³¼ ì—°ê²°ë¨',
      functions: ['open()', 'read()', 'write()', 'close()'],
      position: { x: 400, y: -350 }
    },
    
    // Socket Lifecycle (ì™¼ìª½ ì„¸ë¡œ)
    {
      id: 'socket-create',
      label: 'socket()',
      level: 'LIFECYCLE',
      desc: 'Socket ìƒì„±',
      detailedDesc: 'ìƒˆë¡œìš´ Socketì„ ìƒì„±í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- struct socket êµ¬ì¡°ì²´ í• ë‹¹\n- í”„ë¡œí† ì½œë³„ struct sock í• ë‹¹ (TCP/UDP ë“±)\n- VFS inode ìƒì„± ë° fd í• ë‹¹\n- ì´ˆê¸° ìƒíƒœ: SS_UNCONNECTED',
      functions: ['sys_socket()', 'sock_create()'],
      position: { x: -400, y: -150 }
    },
    {
      id: 'socket-bind',
      label: 'bind()',
      level: 'LIFECYCLE',
      desc: 'ì£¼ì†Œ ë°”ì¸ë”©',
      detailedDesc: 'Socketì— ë¡œì»¬ ì£¼ì†Œ(IP, Port)ë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- ì£¼ì†Œ ì¤‘ë³µ ê²€ì‚¬\n- í”„ë¡œí† ì½œë³„ ë°”ì¸ë”© í…Œì´ë¸”ì— ë“±ë¡\n- ìƒíƒœ: SS_UNCONNECTED ìœ ì§€',
      functions: ['sys_bind()', 'inet_bind()'],
      position: { x: -400, y: -50 }
    },
    {
      id: 'socket-listen',
      label: 'listen()',
      level: 'LIFECYCLE',
      desc: 'ì—°ê²° ëŒ€ê¸° ì‹œì‘',
      detailedDesc: 'ì„œë²„ Socketì´ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ì„ ë°›ì„ ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- backlog í ìƒì„± (SYN backlog, accept queue)\n- ìƒíƒœ: SS_LISTENING\n- í´ë¼ì´ì–¸íŠ¸ì˜ SYN íŒ¨í‚· ëŒ€ê¸°',
      functions: ['sys_listen()', 'inet_listen()'],
      position: { x: -400, y: 50 }
    },
    {
      id: 'socket-accept',
      label: 'accept()',
      level: 'LIFECYCLE',
      desc: 'ì—°ê²° ìˆ˜ë½',
      detailedDesc: 'accept queueì—ì„œ ì™„ì„±ëœ ì—°ê²°ì„ ê°€ì ¸ì™€ ìƒˆ Socketì„ ìƒì„±í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- accept queueì—ì„œ ì™„ì„±ëœ ì—°ê²° ì¶”ì¶œ\n- ìƒˆë¡œìš´ struct socket í• ë‹¹ (í´ë¼ì´ì–¸íŠ¸ìš©)\n- ìƒíƒœ: SS_CONNECTED\n- TCP 3-way handshake ì™„ë£Œëœ ì—°ê²°',
      functions: ['sys_accept()', 'inet_accept()'],
      position: { x: -400, y: 150 }
    },
    {
      id: 'socket-connect',
      label: 'connect()',
      level: 'LIFECYCLE',
      desc: 'ì—°ê²° ìš”ì²­',
      detailedDesc: 'í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì— ì—°ê²°ì„ ìš”ì²­í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- TCP 3-way handshake ì‹œì‘\n- ìƒíƒœ ì „ì´: SS_UNCONNECTED â†’ SS_CONNECTING â†’ SS_CONNECTED\n- SYN íŒ¨í‚· ì „ì†¡ ë° ì‘ë‹µ ëŒ€ê¸°',
      functions: ['sys_connect()', 'inet_stream_connect()'],
      position: { x: -400, y: 250 }
    },
    {
      id: 'socket-io',
      label: 'send/recv',
      level: 'LIFECYCLE',
      desc: 'ë°ì´í„° ì†¡ìˆ˜ì‹ ',
      detailedDesc: 'ì—°ê²°ëœ Socketì„ í†µí•´ ë°ì´í„°ë¥¼ ì†¡ìˆ˜ì‹ í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- send: ì‚¬ìš©ì ë²„í¼ â†’ socket send queue â†’ TCP â†’ ë„¤íŠ¸ì›Œí¬\n- recv: ë„¤íŠ¸ì›Œí¬ â†’ TCP â†’ socket receive queue â†’ ì‚¬ìš©ì ë²„í¼\n- blocking/non-blocking ëª¨ë“œì— ë”°ë¼ ë™ì‘ ë‹¤ë¦„\n- ìƒíƒœ: SS_CONNECTED ìœ ì§€',
      functions: ['sys_send()', 'sys_recv()', 'tcp_sendmsg()', 'tcp_recvmsg()'],
      position: { x: -400, y: 350 }
    },
    {
      id: 'socket-close',
      label: 'close()',
      level: 'LIFECYCLE',
      desc: 'Socket ì¢…ë£Œ',
      detailedDesc: 'Socketì„ ë‹«ê³  ìì›ì„ í•´ì œí•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- TCP: FIN íŒ¨í‚· ì „ì†¡ (ì •ìƒ ì¢…ë£Œ)\n- ìƒíƒœ: SS_DISCONNECTING â†’ SS_UNCONNECTED\n- struct socket, struct sock í•´ì œ\n- fd í…Œì´ë¸”ì—ì„œ ì œê±°',
      functions: ['sys_close()', 'sock_close()', 'inet_release()'],
      position: { x: -400, y: 450 }
    },
    
    // Socket vs ë‹¤ë¥¸ ìì›ë“¤ (ì¤‘ì•™ ì„¸ë¡œ)
    // ì¤‘ìš”: Regular File, Pipe, Socketì€ ëª¨ë‘ File Descriptorì˜ "ë‹¤ë¥¸ ì¢…ë¥˜"ì…ë‹ˆë‹¤.
    // ì´ë“¤ì€ Socketì˜ ì¢…ë¥˜ê°€ ì•„ë‹ˆë©°, Socketì— í¬í•¨ëœ ê¸°ëŠ¥ë„ ì•„ë‹™ë‹ˆë‹¤.
    {
      id: 'epoll',
      label: 'epoll',
      level: 'COMPARISON',
      desc: 'I/O ì´ë²¤íŠ¸ ëª¨ë‹ˆí„°ë§ ë©”ì»¤ë‹ˆì¦˜',
      detailedDesc: 'epollì€ Socketì„ í¬í•¨í•œ ì—¬ëŸ¬ File Descriptorì˜ I/O ì´ë²¤íŠ¸ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.\n\nì¤‘ìš”: Socketì˜ ì¢…ë¥˜ë„, Socketì— í¬í•¨ëœ ê¸°ëŠ¥ë„ ì•„ë‹™ë‹ˆë‹¤!\n- epollì€ Socket, Regular File, Pipe ë“± ì—¬ëŸ¬ File Descriptorë¥¼ ëª¨ë‹ˆí„°ë§í•˜ëŠ” "ë„êµ¬"ì…ë‹ˆë‹¤\n- Socket ìì²´ê°€ ì•„ë‹ˆë¼ Socketì˜ ìƒíƒœ ë³€í™”(ì½ê¸° ê°€ëŠ¥, ì“°ê¸° ê°€ëŠ¥ ë“±)ë¥¼ ê°ì‹œí•©ë‹ˆë‹¤\n- ê³ ì„±ëŠ¥ ì„œë²„ì—ì„œ ì—¬ëŸ¬ Socketì„ ë™ì‹œì— íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤\n\níŠ¹ì§•:\n- Socket, Regular File, Pipe ë“± ì—¬ëŸ¬ File Descriptorì˜ ì´ë²¤íŠ¸ë¥¼ ê°ì§€\n- select/pollë³´ë‹¤ í›¨ì”¬ íš¨ìœ¨ì  (O(1) ë³µì¡ë„)\n- Socketì˜ ìƒíƒœ ë³€í™”ë¥¼ ê°ì‹œí•˜ì—¬ ì´ë²¤íŠ¸ ê¸°ë°˜ í”„ë¡œê·¸ë˜ë° ì§€ì›\n- ê³ ì„±ëŠ¥ ì„œë²„ì—ì„œ í•„ìˆ˜\n- epoll_create()ë¡œ ìƒì„±, epoll_ctl()ë¡œ ë“±ë¡, epoll_wait()ë¡œ ëŒ€ê¸°',
      functions: ['epoll_create()', 'epoll_ctl()', 'epoll_wait()'],
      position: { x: 0, y: -450 }
    },
    {
      id: 'regular-file',
      label: 'Regular File',
      level: 'COMPARISON',
      desc: 'ì¼ë°˜ íŒŒì¼ (File Descriptorì˜ í•œ ì¢…ë¥˜)',
      detailedDesc: 'Regular Fileì€ File Descriptorì˜ í•œ ì¢…ë¥˜ë¡œ, ë””ìŠ¤í¬ì— ì €ì¥ë˜ëŠ” ì‹¤ì œ íŒŒì¼ì…ë‹ˆë‹¤.\n\nì¤‘ìš”: Socketì˜ ì¢…ë¥˜ê°€ ì•„ë‹™ë‹ˆë‹¤!\n- Regular File, Pipe, Socketì€ ëª¨ë‘ File Descriptorì˜ ë‹¤ë¥¸ "ì¢…ë¥˜"ì…ë‹ˆë‹¤\n- ì´ë“¤ì€ ê°™ì€ ë ˆë²¨ì˜ ì»¤ë„ ìì›ì´ë©°, ëª¨ë‘ File Descriptorë¥¼ í†µí•´ ì ‘ê·¼ë©ë‹ˆë‹¤\n- Unix ì² í•™: "ëª¨ë“  ê²ƒì´ íŒŒì¼" - íŒŒì¼, íŒŒì´í”„, ì†Œì¼“ ëª¨ë‘ File Descriptorë¡œ í†µì¼\n\níŠ¹ì§•:\n- ë””ìŠ¤í¬ I/Oë¥¼ í†µí•´ ë°ì´í„° ì €ì¥/ì½ê¸°\n- íŒŒì¼ ì‹œìŠ¤í…œ(inode)ìœ¼ë¡œ ê´€ë¦¬\n- seek() ê°€ëŠ¥ (ì„ì˜ ìœ„ì¹˜ ì ‘ê·¼)\n- ì˜êµ¬ ì €ì¥\n- open()ìœ¼ë¡œ ìƒì„±, read()/write()ë¡œ ì ‘ê·¼',
      functions: ['open()', 'read()', 'write()', 'lseek()'],
      position: { x: 0, y: -150 }
    },
    {
      id: 'pipe',
      label: 'Pipe',
      level: 'COMPARISON',
      desc: 'í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹  (File Descriptorì˜ í•œ ì¢…ë¥˜)',
      detailedDesc: 'PipeëŠ” File Descriptorì˜ í•œ ì¢…ë¥˜ë¡œ, ê°™ì€ ë¨¸ì‹  ë‚´ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ì„ ìœ„í•œ ìì›ì…ë‹ˆë‹¤.\n\nì¤‘ìš”: Socketì˜ ì¢…ë¥˜ê°€ ì•„ë‹™ë‹ˆë‹¤!\n- Regular File, Pipe, Socketì€ ëª¨ë‘ File Descriptorì˜ ë‹¤ë¥¸ "ì¢…ë¥˜"ì…ë‹ˆë‹¤\n- PipeëŠ” Socketê³¼ ê°™ì€ ë ˆë²¨ì˜ ì»¤ë„ ìì›ì…ë‹ˆë‹¤\n- Socketì€ ë„¤íŠ¸ì›Œí¬ í†µì‹ ìš©, PipeëŠ” ë¡œì»¬ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ìš©\n\nPipe vs Unix Domain Socket (AF_UNIX):\n- Pipe: ë‹¨ë°©í–¥ í†µì‹ , ë¶€ëª¨-ìì‹ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ , pipe()ë¡œ ìƒì„±\n- Unix Domain Socket: ì–‘ë°©í–¥ í†µì‹ , ì„ì˜ì˜ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ , socket(AF_UNIX, ...)ë¡œ ìƒì„±\n- ì¤‘ìš”: Unix Domain Socketì€ Socketì˜ í•œ ì¢…ë¥˜ì…ë‹ˆë‹¤! Pipeê°€ ì•„ë‹™ë‹ˆë‹¤!\n\níŠ¹ì§•:\n- ì»¤ë„ ë©”ëª¨ë¦¬ì˜ ë²„í¼ ì‚¬ìš©\n- ë‹¨ë°©í–¥ í†µì‹  (ì½ê¸°/ì“°ê¸° ì—”ë“œ ë¶„ë¦¬)\n- ë¶€ëª¨-ìì‹ í”„ë¡œì„¸ìŠ¤ ê°„ í†µì‹ ì— ì£¼ë¡œ ì‚¬ìš©\n- ë„¤íŠ¸ì›Œí¬ ì—†ì´ ë™ì¼ ë¨¸ì‹  ë‚´ í†µì‹ \n- pipe()ë¡œ ìƒì„±, read()/write()ë¡œ ì ‘ê·¼',
      functions: ['pipe()', 'read()', 'write()'],
      position: { x: 0, y: -50 }
    },
    
    // ì»¤ë„ êµ¬ì¡° (ì˜¤ë¥¸ìª½ ì„¸ë¡œ)
    {
      id: 'struct-socket',
      label: 'struct socket',
      level: 'KERNEL',
      desc: 'VFSì™€ì˜ ì¸í„°í˜ì´ìŠ¤',
      detailedDesc: 'struct socketì€ VFS(Virtual File System)ì™€ì˜ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.\n\nì—­í• :\n- íŒŒì¼ ë””ìŠ¤í¬ë¦½í„°ì™€ ì—°ê²°\n- VFS inodeì™€ ì—°ë™\n- í”„ë¡œì„¸ìŠ¤ê°€ ì ‘ê·¼í•˜ëŠ” ìƒìœ„ ë ˆë²¨ ì¸í„°í˜ì´ìŠ¤\n- struct sockì„ í¬í•¨ (ì‹¤ì œ í”„ë¡œí† ì½œ ì²˜ë¦¬)',
      functions: ['socket_alloc()', 'sock_alloc()'],
      position: { x: 400, y: -150 }
    },
    {
      id: 'struct-sock',
      label: 'struct sock',
      level: 'KERNEL',
      desc: 'í”„ë¡œí† ì½œë³„ ì‹¤ì œ êµ¬í˜„',
      detailedDesc: 'struct sockì€ ì‹¤ì œ ë„¤íŠ¸ì›Œí¬ í”„ë¡œí† ì½œ(TCP/UDP ë“±)ì„ ì²˜ë¦¬í•˜ëŠ” êµ¬ì¡°ì²´ì…ë‹ˆë‹¤.\n\nì—­í• :\n- í”„ë¡œí† ì½œë³„ ìƒíƒœ ê´€ë¦¬ (TCP ìƒíƒœ ë¨¸ì‹  ë“±)\n- receive queue, send queue ê´€ë¦¬\n- ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒê³¼ ì§ì ‘ ì—°ê²°\n- sk_buff í ê´€ë¦¬',
      functions: ['sk_alloc()', 'tcp_v4_init_sock()'],
      position: { x: 400, y: -50 }
    },
    {
      id: 'kernel-queues',
      label: 'Kernel Queues',
      level: 'KERNEL',
      desc: 'Socket ë‚´ë¶€ í êµ¬ì¡°',
      detailedDesc: 'Socketì€ ì—¬ëŸ¬ ì¢…ë¥˜ì˜ íë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ë²„í¼ë§í•©ë‹ˆë‹¤. ê° íëŠ” Socketì˜ ìƒëª…ì£¼ê¸°ì™€ ì„±ëŠ¥ì— ì§ì ‘ì ì¸ ì˜í–¥ì„ ë¯¸ì¹©ë‹ˆë‹¤.\n\n1. Receive Queue (sk_receive_queue)\nì—­í• : ë„¤íŠ¸ì›Œí¬ì—ì„œ ìˆ˜ì‹ ëœ ë°ì´í„°ë¥¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì½ì„ ë•Œê¹Œì§€ ë³´ê´€í•˜ëŠ” í\nìœ„ì¹˜: struct sock êµ¬ì¡°ì²´ ë‚´ë¶€\në™ì‘: í”„ë¡œí† ì½œ ìŠ¤íƒ(TCP/UDP)ì—ì„œ ì²˜ë¦¬ëœ íŒ¨í‚·ì´ ì´ íì— ì¶”ê°€ë˜ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ recv()/read()ê°€ ì´ íì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ê°‘ë‹ˆë‹¤.\n\nì»¤ë„ ì˜µì…˜:\n- net.core.rmem_default: ê¸°ë³¸ ìˆ˜ì‹  ë²„í¼ í¬ê¸° (ê¸°ë³¸ê°’: 212992 bytes)\n- net.core.rmem_max: ìµœëŒ€ ìˆ˜ì‹  ë²„í¼ í¬ê¸° (ê¸°ë³¸ê°’: 212992 bytes, ëª¨ë“  í”„ë¡œí† ì½œì— ì ìš©)\n- net.ipv4.tcp_rmem: TCP ì „ìš© ìˆ˜ì‹  ë²„í¼ (min default max 3ê°œ ê°’, ê¸°ë³¸ê°’: 4096 87380 6291456)\n- ì‹¤ì œ TCP ì†Œì¼“ ìµœëŒ€ ë²„í¼ = min(net.ipv4.tcp_rmem[2], net.core.rmem_max)\n\n2. Send Queue (sk_write_queue)\nì—­í• : ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì „ì†¡í•œ ë°ì´í„°ë¥¼ ë„¤íŠ¸ì›Œí¬ë¡œ ë³´ë‚´ê¸° ì „ê¹Œì§€ ë³´ê´€í•˜ëŠ” í\nìœ„ì¹˜: struct sock êµ¬ì¡°ì²´ ë‚´ë¶€\në™ì‘: ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ send()/write()ê°€ ì´ íì— ë°ì´í„°ë¥¼ ì¶”ê°€í•˜ê³ , TCP/UDPê°€ ë„¤íŠ¸ì›Œí¬ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.\n\nì»¤ë„ ì˜µì…˜:\n- net.core.wmem_default: ê¸°ë³¸ ì†¡ì‹  ë²„í¼ í¬ê¸° (ê¸°ë³¸ê°’: 212992 bytes)\n- net.core.wmem_max: ìµœëŒ€ ì†¡ì‹  ë²„í¼ í¬ê¸° (ê¸°ë³¸ê°’: 212992 bytes, ëª¨ë“  í”„ë¡œí† ì½œì— ì ìš©)\n- net.ipv4.tcp_wmem: TCP ì „ìš© ì†¡ì‹  ë²„í¼ (min default max 3ê°œ ê°’, ê¸°ë³¸ê°’: 4096 16384 4194304)\n- ì‹¤ì œ TCP ì†Œì¼“ ìµœëŒ€ ë²„í¼ = min(net.ipv4.tcp_wmem[2], net.core.wmem_max)\n\n3. Accept Queue (ì™„ì„±ëœ ì—°ê²° ëŒ€ê¸° í)\nì—­í• : TCP 3-way handshakeê°€ ì™„ë£Œëœ ì—°ê²°ì„ accept()ê°€ ê°€ì ¸ê°ˆ ë•Œê¹Œì§€ ëŒ€ê¸°ì‹œí‚¤ëŠ” í (ì„œë²„ ì „ìš©)\nìœ„ì¹˜: struct inet_connection_sock êµ¬ì¡°ì²´ ë‚´ë¶€\në™ì‘: í´ë¼ì´ì–¸íŠ¸ì˜ SYN â†’ ì„œë²„ì˜ SYN-ACK â†’ í´ë¼ì´ì–¸íŠ¸ì˜ ACKê°€ ì™„ë£Œë˜ë©´ ì´ íì— ì¶”ê°€ë©ë‹ˆë‹¤.\n\nì»¤ë„ ì˜µì…˜:\n- net.core.somaxconn: accept queue ìµœëŒ€ í¬ê¸° (ê¸°ë³¸ê°’: 4096)\n- listen()ì˜ backlog ì¸ìì™€ somaxconn ì¤‘ ì‘ì€ ê°’ì´ ì‹¤ì œ í¬ê¸°ê°€ ë©ë‹ˆë‹¤.\n- íê°€ ê°€ë“ ì°¨ë©´: í´ë¼ì´ì–¸íŠ¸ì˜ ACKê°€ ë¬´ì‹œë˜ì–´ ì—°ê²°ì´ ì‹¤íŒ¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\n4. SYN Backlog (SYN_RCVD ìƒíƒœ ì—°ê²° ëŒ€ê¸° í)\nì—­í• : SYN_RCVD ìƒíƒœì˜ ì—°ê²°(SYNì„ ë°›ì•˜ì§€ë§Œ ì•„ì§ 3-way handshakeê°€ ì™„ë£Œë˜ì§€ ì•Šì€ ì—°ê²°)ì„ ë³´ê´€í•˜ëŠ” í\nìœ„ì¹˜: struct inet_connection_sock êµ¬ì¡°ì²´ ë‚´ë¶€\në™ì‘: í´ë¼ì´ì–¸íŠ¸ì˜ SYNì„ ë°›ê³  SYN-ACKë¥¼ ë³´ë‚¸ í›„, í´ë¼ì´ì–¸íŠ¸ì˜ ACKë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœì˜ ì—°ê²°ì„ ì €ì¥í•©ë‹ˆë‹¤.\n\nì»¤ë„ ì˜µì…˜:\n- net.ipv4.tcp_max_syn_backlog: SYN backlog ìµœëŒ€ í¬ê¸° (ê¸°ë³¸ê°’: 2048)\n- SYN flood ê³µê²© ë°©ì–´ë¥¼ ìœ„í•´ ì œí•œë©ë‹ˆë‹¤.\n- íê°€ ê°€ë“ ì°¨ë©´: ìƒˆë¡œìš´ SYN íŒ¨í‚·ì´ ë“œë¡­ë˜ì–´ ì—°ê²°ì´ ì‹¤íŒ¨í•©ë‹ˆë‹¤.\n\nì¤‘ìš”: í í¬ê¸°ì™€ ì„±ëŠ¥\n- íê°€ ë„ˆë¬´ ì‘ìœ¼ë©´: ê³ ì† ë„¤íŠ¸ì›Œí¬ì—ì„œ íŒ¨í‚· ë“œë¡­, ì—°ê²° ì‹¤íŒ¨, ì„±ëŠ¥ ì €í•˜\n- íê°€ ë„ˆë¬´ í¬ë©´: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ ì¦ê°€, DDoS ê³µê²©ì— ì·¨ì•½\n- ì ì ˆí•œ í¬ê¸° ì„¤ì •ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.\n\nëª¨ë‹ˆí„°ë§:\n- ss -i: ì†Œì¼“ì˜ ìˆ˜ì‹ /ì†¡ì‹  í ìƒíƒœ í™•ì¸\n- ss -tn state listen: LISTEN ì†Œì¼“ì˜ accept queue í™•ì¸\n- /proc/net/sockstat: ì „ì²´ ì†Œì¼“ í†µê³„',
      functions: ['skb_queue_tail()', 'skb_dequeue()', 'sk_acceptq_added()', 'sk_acceptq_removed()'],
      position: { x: 400, y: 50 }
    },
    
    // TCP ì†Œì¼“ ìƒíƒœ ì „ì´ (nginx ì„œë²„ ì˜ˆì‹œ)
    {
      id: 'nginx-start',
      label: 'nginx ì‹œì‘',
      level: 'LIFECYCLE',
      desc: 'nginx ì„œë²„ í”„ë¡œì„¸ìŠ¤ ì‹œì‘',
      detailedDesc: 'nginx ì„œë²„ê°€ ì‹œì‘ë˜ë©´ ë§ˆìŠ¤í„° í”„ë¡œì„¸ìŠ¤ê°€ ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ë¥¼ ìƒì„±í•˜ê³ , ê° ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ê°€ ì„œë²„ ì†Œì¼“ì„ ìƒì„±í•©ë‹ˆë‹¤.\n\nì´ˆê¸° ë‹¨ê³„:\n- ë§ˆìŠ¤í„° í”„ë¡œì„¸ìŠ¤: ì„¤ì • íŒŒì¼ ì½ê¸°, ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ ìƒì„±\n- ì›Œì»¤ í”„ë¡œì„¸ìŠ¤: ì„œë²„ ì†Œì¼“ ìƒì„± ì¤€ë¹„',
      functions: ['nginx master process', 'worker process'],
      position: { x: 0, y: 500 }
    },
    {
      id: 'tcp-socket-create',
      label: 'socket()\nTCP ìƒì„±',
      level: 'LIFECYCLE',
      desc: 'TCP ì†Œì¼“ ìƒì„±',
      detailedDesc: 'nginx ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ê°€ ì„œë²„ ì†Œì¼“ì„ ìƒì„±í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- socket(AF_INET, SOCK_STREAM, IPPROTO_TCP) í˜¸ì¶œ\n- struct socket êµ¬ì¡°ì²´ í• ë‹¹\n- struct tcp_sock í• ë‹¹\n- ì´ˆê¸° ìƒíƒœ: SS_UNCONNECTED (TCP: CLOSED)',
      functions: ['sys_socket()', 'inet_create()', 'tcp_v4_init_sock()'],
      position: { x: 0, y: 600 }
    },
    {
      id: 'tcp-bind',
      label: 'bind()\ní¬íŠ¸ 80',
      level: 'LIFECYCLE',
      desc: 'í¬íŠ¸ 80ì— ë°”ì¸ë”©',
      detailedDesc: 'nginxê°€ í¬íŠ¸ 80ì— ë°”ì¸ë”©í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- bind(0.0.0.0:80) í˜¸ì¶œ\n- ì£¼ì†Œ ì¤‘ë³µ ê²€ì‚¬\n- inet_bind_hash_tableì— ë“±ë¡\n- ìƒíƒœ: SS_UNCONNECTED (TCP: CLOSED) ìœ ì§€',
      functions: ['sys_bind()', 'inet_bind()'],
      position: { x: 0, y: 700 }
    },
    {
      id: 'tcp-listen',
      label: 'listen()\nLISTEN ìƒíƒœ',
      level: 'LIFECYCLE',
      desc: 'ì—°ê²° ëŒ€ê¸° ì‹œì‘',
      detailedDesc: 'nginxê°€ í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ì„ ë°›ì„ ì¤€ë¹„ë¥¼ í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- listen(backlog=511) í˜¸ì¶œ\n- SYN backlog í ìƒì„± (net.ipv4.tcp_max_syn_backlog)\n- Accept queue ìƒì„± (min(backlog, net.core.somaxconn))\n- ìƒíƒœ: SS_LISTENING (TCP: LISTEN)\n\nnginx ì„¤ì •:\n- listen 80;\n- backlogëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 511 ë˜ëŠ” somaxconn ì¤‘ ì‘ì€ ê°’',
      functions: ['sys_listen()', 'inet_listen()', 'tcp_listen_start()'],
      position: { x: 0, y: 800 }
    },
    {
      id: 'tcp-listen-state',
      label: 'LISTEN\nìƒíƒœ',
      level: 'KERNEL',
      desc: 'TCP LISTEN ìƒíƒœ',
      detailedDesc: 'ì„œë²„ ì†Œì¼“ì´ í´ë¼ì´ì–¸íŠ¸ì˜ ì—°ê²° ìš”ì²­ì„ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœì…ë‹ˆë‹¤.\n\níŠ¹ì§•:\n- í´ë¼ì´ì–¸íŠ¸ì˜ SYN íŒ¨í‚·ì„ ë°›ì„ ì¤€ë¹„ ì™„ë£Œ\n- SYN backlog í: SYN_RCVD ìƒíƒœ ì—°ê²° ëŒ€ê¸°\n- Accept queue: ì™„ì„±ëœ ì—°ê²° ëŒ€ê¸°\n\nëª¨ë‹ˆí„°ë§:\n- ss -tln state listen: LISTEN ìƒíƒœ ì†Œì¼“ í™•ì¸\n- ss -tnp | grep nginx: nginx ì†Œì¼“ í™•ì¸',
      functions: ['tcp_v4_rcv()', 'tcp_rcv_state_process()'],
      position: { x: 0, y: 900 }
    },
    {
      id: 'client-syn',
      label: 'í´ë¼ì´ì–¸íŠ¸\nSYN íŒ¨í‚·',
      level: 'LIFECYCLE',
      desc: 'í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìš”ì²­',
      detailedDesc: 'í´ë¼ì´ì–¸íŠ¸ê°€ nginx ì„œë²„ì— ì—°ê²°ì„ ìš”ì²­í•©ë‹ˆë‹¤.\n\níŒ¨í‚· íë¦„:\n- í´ë¼ì´ì–¸íŠ¸: SYN íŒ¨í‚· ì „ì†¡ (í¬íŠ¸ 80)\n- ì„œë²„: SYN íŒ¨í‚· ìˆ˜ì‹ \n- ì»¤ë„: tcp_v4_rcv()ì—ì„œ ì²˜ë¦¬\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- LISTEN ì†Œì¼“ ì°¾ê¸° (inet_csk_search_req())\n- ìƒˆë¡œìš´ ì—°ê²° ìš”ì²­ êµ¬ì¡°ì²´ ìƒì„± (struct request_sock)\n- ìƒíƒœ: TCP_SYN_RECV (SYN_RCVD)\n- SYN backlog íì— ì¶”ê°€',
      functions: ['tcp_v4_rcv()', 'tcp_v4_conn_request()', 'inet_csk_reqsk_queue_hash_add()'],
      position: { x: 200, y: 800 }
    },
    {
      id: 'tcp-syn-rcvd',
      label: 'SYN_RCVD\nìƒíƒœ',
      level: 'KERNEL',
      desc: 'TCP SYN_RCVD ìƒíƒœ',
      detailedDesc: 'ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ SYNì„ ë°›ê³  SYN-ACKë¥¼ ë³´ë‚¸ í›„, í´ë¼ì´ì–¸íŠ¸ì˜ ACKë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ìƒíƒœì…ë‹ˆë‹¤.\n\níŠ¹ì§•:\n- SYN backlog íì— ì €ì¥ë¨\n- ì•„ì§ accept queueì— ì—†ìŒ (3-way handshake ë¯¸ì™„ë£Œ)\n- net.ipv4.tcp_max_syn_backlog í¬ê¸° ì œí•œ\n\nSYN flood ë°©ì–´:\n- íê°€ ê°€ë“ ì°¨ë©´ ìƒˆë¡œìš´ SYN íŒ¨í‚· ë“œë¡­\n- SYN cookies í™œì„±í™” ì‹œ ì¿ í‚¤ ê¸°ë°˜ ë°©ì–´',
      functions: ['tcp_synack_timer()', 'tcp_syn_rcv()'],
      position: { x: 200, y: 900 }
    },
    {
      id: 'server-syn-ack',
      label: 'ì„œë²„\nSYN-ACK ì „ì†¡',
      level: 'LIFECYCLE',
      desc: 'ì„œë²„ê°€ SYN-ACK ì‘ë‹µ',
      detailedDesc: 'ì„œë²„ê°€ í´ë¼ì´ì–¸íŠ¸ì˜ SYNì— ëŒ€í•´ SYN-ACKë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- tcp_v4_send_synack() í˜¸ì¶œ\n- SYN-ACK íŒ¨í‚· ìƒì„± ë° ì „ì†¡\n- íƒ€ì´ë¨¸ ì‹œì‘ (í´ë¼ì´ì–¸íŠ¸ ACK ëŒ€ê¸°)\n- ìƒíƒœ: TCP_SYN_RECV ìœ ì§€',
      functions: ['tcp_v4_send_synack()', 'tcp_syn_ack_timer()'],
      position: { x: 200, y: 1000 }
    },
    {
      id: 'client-ack',
      label: 'í´ë¼ì´ì–¸íŠ¸\nACK íŒ¨í‚·',
      level: 'LIFECYCLE',
      desc: 'í´ë¼ì´ì–¸íŠ¸ê°€ ACK ì „ì†¡',
      detailedDesc: 'í´ë¼ì´ì–¸íŠ¸ê°€ ì„œë²„ì˜ SYN-ACKì— ëŒ€í•´ ACKë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.\n\n3-way handshake ì™„ë£Œ:\n- í´ë¼ì´ì–¸íŠ¸: ACK ì „ì†¡\n- ì„œë²„: ACK ìˆ˜ì‹ \n- ì»¤ë„: tcp_v4_do_rcv()ì—ì„œ ì²˜ë¦¬\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- tcp_check_req()ì—ì„œ ìš”ì²­ ê²€ì¦\n- ìƒˆë¡œìš´ ì†Œì¼“ ìƒì„± (struct sock)\n- ìƒíƒœ: TCP_ESTABLISHED\n- Accept queueë¡œ ì´ë™',
      functions: ['tcp_v4_do_rcv()', 'tcp_check_req()', 'tcp_v4_syn_recv_sock()'],
      position: { x: 200, y: 1100 }
    },
    {
      id: 'tcp-established',
      label: 'ESTABLISHED\nìƒíƒœ',
      level: 'KERNEL',
      desc: 'TCP ESTABLISHED ìƒíƒœ',
      detailedDesc: '3-way handshakeê°€ ì™„ë£Œë˜ì–´ ì—°ê²°ì´ ìˆ˜ë¦½ëœ ìƒíƒœì…ë‹ˆë‹¤.\n\níŠ¹ì§•:\n- Accept queueì— ì €ì¥ë¨\n- ì• í”Œë¦¬ì¼€ì´ì…˜(nginx)ì´ accept()ë¥¼ í˜¸ì¶œí•  ë•Œê¹Œì§€ ëŒ€ê¸°\n- ë°ì´í„° ì†¡ìˆ˜ì‹  ì¤€ë¹„ ì™„ë£Œ\n\nAccept queue:\n- net.core.somaxconn í¬ê¸° ì œí•œ\n- íê°€ ê°€ë“ ì°¨ë©´ í´ë¼ì´ì–¸íŠ¸ì˜ ACKê°€ ë¬´ì‹œë  ìˆ˜ ìˆìŒ\n- ss -tn state established | grep :80: ESTABLISHED ì—°ê²° í™•ì¸',
      functions: ['tcp_rcv_established()', 'tcp_data_queue()'],
      position: { x: 200, y: 1200 }
    },
    {
      id: 'nginx-accept',
      label: 'nginx\naccept()',
      level: 'LIFECYCLE',
      desc: 'ì—°ê²° ìˆ˜ë½',
      detailedDesc: 'nginx ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ê°€ accept()ë¥¼ í˜¸ì¶œí•˜ì—¬ ì™„ì„±ëœ ì—°ê²°ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.\n\nì»¤ë„ ë‚´ë¶€ ë™ì‘:\n- sys_accept() í˜¸ì¶œ\n- Accept queueì—ì„œ ì™„ì„±ëœ ì—°ê²° ì¶”ì¶œ\n- ìƒˆë¡œìš´ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° í• ë‹¹\n- ìƒˆë¡œìš´ struct socket ìƒì„± (í´ë¼ì´ì–¸íŠ¸ìš©)\n- ìƒíƒœ: SS_CONNECTED (TCP: ESTABLISHED)\n\nnginx ë™ì‘:\n- epoll_wait()ë¡œ ì´ë²¤íŠ¸ ëŒ€ê¸°\n- ì´ë²¤íŠ¸ ë°œìƒ ì‹œ accept() í˜¸ì¶œ\n- ìƒˆë¡œìš´ ì—°ê²°ì„ ì²˜ë¦¬í•  ì›Œì»¤ í”„ë¡œì„¸ìŠ¤ ì„ íƒ',
      functions: ['sys_accept()', 'inet_accept()', 'tcp_accept()'],
      position: { x: 0, y: 1200 }
    },
    {
      id: 'new-socket',
      label: 'ì‹ ê·œ ì†Œì¼“\nìƒì„±',
      level: 'KERNEL',
      desc: 'í´ë¼ì´ì–¸íŠ¸ìš© ìƒˆ ì†Œì¼“',
      detailedDesc: 'accept()ë¥¼ í†µí•´ í´ë¼ì´ì–¸íŠ¸ ì „ìš© ìƒˆë¡œìš´ ì†Œì¼“ì´ ìƒì„±ë©ë‹ˆë‹¤.\n\níŠ¹ì§•:\n- ì›ë³¸ LISTEN ì†Œì¼“ê³¼ëŠ” ë³„ê°œì˜ ì†Œì¼“\n- ìƒˆë¡œìš´ íŒŒì¼ ë””ìŠ¤í¬ë¦½í„° í• ë‹¹\n- í´ë¼ì´ì–¸íŠ¸ì˜ IP:Port ì •ë³´ í¬í•¨\n- ìƒíƒœ: ESTABLISHED\n\nnginxì—ì„œ:\n- ê° í´ë¼ì´ì–¸íŠ¸ ì—°ê²°ë§ˆë‹¤ ìƒˆë¡œìš´ ì†Œì¼“\n- ì›ë³¸ LISTEN ì†Œì¼“ì€ ê³„ì† LISTEN ìƒíƒœ ìœ ì§€\n- ss -tnp | grep nginx: ì—¬ëŸ¬ ì†Œì¼“ í™•ì¸ ê°€ëŠ¥',
      functions: ['sock_alloc()', 'inet_csk_accept()'],
      position: { x: 0, y: 1300 }
    },
    {
      id: 'data-transfer',
      label: 'ë°ì´í„°\nì†¡ìˆ˜ì‹ ',
      level: 'LIFECYCLE',
      desc: 'HTTP ìš”ì²­/ì‘ë‹µ',
      detailedDesc: 'nginxì™€ í´ë¼ì´ì–¸íŠ¸ ê°„ HTTP ìš”ì²­/ì‘ë‹µì´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.\n\në°ì´í„° íë¦„:\n- í´ë¼ì´ì–¸íŠ¸: HTTP ìš”ì²­ ì „ì†¡\n- nginx: ìš”ì²­ ìˆ˜ì‹  (recv queue)\n- nginx: HTTP ì‘ë‹µ ìƒì„± ë° ì „ì†¡ (send queue)\n- í´ë¼ì´ì–¸íŠ¸: ì‘ë‹µ ìˆ˜ì‹ \n\nì»¤ë„ ë‚´ë¶€:\n- ìˆ˜ì‹ : tcp_rcv_established() â†’ sk_receive_queue\n- ì†¡ì‹ : tcp_sendmsg() â†’ sk_write_queue â†’ ë„¤íŠ¸ì›Œí¬\n- ìƒíƒœ: ESTABLISHED ìœ ì§€',
      functions: ['tcp_recvmsg()', 'tcp_sendmsg()', 'tcp_rcv_established()'],
      position: { x: 0, y: 1400 }
    },
    {
      id: 'tcp-close',
      label: 'ì—°ê²° ì¢…ë£Œ\nFIN',
      level: 'LIFECYCLE',
      desc: 'ì—°ê²° ì¢…ë£Œ ì‹œì‘',
      detailedDesc: 'HTTP ìš”ì²­/ì‘ë‹µ ì™„ë£Œ í›„ ì—°ê²°ì´ ì¢…ë£Œë©ë‹ˆë‹¤.\n\nì¢…ë£Œ ê³¼ì •:\n- nginx: close() í˜¸ì¶œ ë˜ëŠ” í´ë¼ì´ì–¸íŠ¸: FIN ì „ì†¡\n- ì„œë²„: FIN ì „ì†¡ â†’ FIN_WAIT_1\n- í´ë¼ì´ì–¸íŠ¸: ACK â†’ FIN_WAIT_2\n- í´ë¼ì´ì–¸íŠ¸: FIN â†’ TIME_WAIT\n- ì„œë²„: ACK â†’ CLOSED\n\nìƒíƒœ ì „ì´:\n- ESTABLISHED â†’ FIN_WAIT_1 â†’ FIN_WAIT_2 â†’ TIME_WAIT â†’ CLOSED\n- ë˜ëŠ” ESTABLISHED â†’ CLOSE_WAIT â†’ LAST_ACK â†’ CLOSED',
      functions: ['tcp_close()', 'tcp_send_fin()', 'tcp_fin()'],
      position: { x: 0, y: 1500 }
    },
    {
      id: 'tcp-time-wait',
      label: 'TIME_WAIT\nìƒíƒœ',
      level: 'KERNEL',
      desc: 'TCP TIME_WAIT ìƒíƒœ',
      detailedDesc: 'ì—°ê²° ì¢…ë£Œ í›„ ì¼ì • ì‹œê°„ ëŒ€ê¸°í•˜ëŠ” ìƒíƒœì…ë‹ˆë‹¤.\n\nëª©ì :\n- ë§ˆì§€ë§‰ ACKê°€ ì†ì‹¤ëœ ê²½ìš°ë¥¼ ëŒ€ë¹„\n- ê°™ì€ í¬íŠ¸ ì¬ì‚¬ìš© ë°©ì§€ (2MSL ëŒ€ê¸°)\n- ë„¤íŠ¸ì›Œí¬ì—ì„œ ì§€ì—°ëœ íŒ¨í‚· ì²˜ë¦¬\n\níŠ¹ì§•:\n- ê¸°ë³¸ 2MSL (Maximum Segment Lifetime) ëŒ€ê¸°\n- net.ipv4.tcp_fin_timeout: FIN_WAIT_2 ìƒíƒœ ëŒ€ê¸° ì‹œê°„\n- TIME_WAIT ì†Œì¼“ì´ ë§ìœ¼ë©´ í¬íŠ¸ ê³ ê°ˆ ê°€ëŠ¥\n\nëª¨ë‹ˆí„°ë§:\n- ss -tn state time-wait: TIME_WAIT ìƒíƒœ ì†Œì¼“ í™•ì¸\n- netstat -an | grep TIME_WAIT',
      functions: ['tcp_time_wait()', 'tcp_twsk_destructor()'],
      position: { x: 200, y: 1400 }
    }
  ],
  
  edges: [
    // Socketì˜ ì—­ì‚¬
    { source: 'bsd-socket', target: 'linux-socket' },
    { source: 'linux-socket', target: 'socket-core' },
    
    // File Descriptor ê´€ê³„
    { source: 'file-descriptor', target: 'socket-core' },
    
    // Socket vs ë‹¤ë¥¸ ìì›ë“¤
    { source: 'file-descriptor', target: 'regular-file' },
    { source: 'file-descriptor', target: 'pipe' },
    { source: 'epoll', target: 'socket-core' },
    
    // Socket Lifecycle
    { source: 'socket-create', target: 'socket-bind' },
    { source: 'socket-bind', target: 'socket-listen' },
    { source: 'socket-listen', target: 'socket-accept' },
    { source: 'socket-create', target: 'socket-connect' },
    { source: 'socket-connect', target: 'socket-io' },
    { source: 'socket-accept', target: 'socket-io' },
    { source: 'socket-io', target: 'socket-close' },
    { source: 'socket-core', target: 'socket-create' },
    
    // ì»¤ë„ êµ¬ì¡°
    { source: 'socket-core', target: 'struct-socket' },
    { source: 'struct-socket', target: 'struct-sock' },
    { source: 'struct-sock', target: 'kernel-queues' },
    
    // TCP ì†Œì¼“ ìƒíƒœ ì „ì´ (nginx ì„œë²„ ì˜ˆì‹œ)
    { source: 'nginx-start', target: 'tcp-socket-create' },
    { source: 'tcp-socket-create', target: 'tcp-bind' },
    { source: 'tcp-bind', target: 'tcp-listen' },
    { source: 'tcp-listen', target: 'tcp-listen-state' },
    { source: 'tcp-listen-state', target: 'client-syn' },
    { source: 'client-syn', target: 'tcp-syn-rcvd' },
    { source: 'tcp-syn-rcvd', target: 'server-syn-ack' },
    { source: 'server-syn-ack', target: 'client-ack' },
    { source: 'client-ack', target: 'tcp-established' },
    { source: 'tcp-established', target: 'nginx-accept' },
    { source: 'nginx-accept', target: 'new-socket' },
    { source: 'new-socket', target: 'data-transfer' },
    { source: 'data-transfer', target: 'tcp-close' },
    { source: 'tcp-close', target: 'tcp-time-wait' }
  ]
};

// ë ˆë²¨ë³„ ìƒ‰ìƒ ì •ì˜
const LEVEL_COLORS = {
  'CORE': '#2563eb',        // íŒŒë€ìƒ‰ - í•µì‹¬ ê°œë…
  'HISTORY': '#7c3aed',     // ë³´ë¼ìƒ‰ - ì—­ì‚¬
  'KERNEL': '#dc2626',      // ë¹¨ê°„ìƒ‰ - ì»¤ë„ êµ¬ì¡°
  'LIFECYCLE': '#059669',   // ì´ˆë¡ìƒ‰ - ìƒëª…ì£¼ê¸°
  'COMPARISON': '#ea580c'   // ì£¼í™©ìƒ‰ - ë¹„êµ
};

// Cytoscape ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
const cy = cytoscape({
  container: document.getElementById('cy'),
  
  wheelSensitivity: 0.15,
  minZoom: 0.2,
  maxZoom: 4,
  panningEnabled: true,
  zoomingEnabled: true,
  
  style: [
    {
      selector: 'node',
      style: {
        'label': 'data(label)',
        'text-valign': 'center',
        'text-halign': 'center',
        'color': '#fff',
        'background-color': 'data(color)',
        'width': 140,
        'height': 60,
        'font-size': 13,
        'font-weight': 'bold',
        'shape': 'roundrectangle',
        'border-width': 2,
        'border-color': '#fff',
        'text-wrap': 'wrap',
        'text-max-width': 130
      }
    },
    {
      selector: 'edge',
      style: {
        'width': 3,
        'line-color': '#60a5fa',
        'target-arrow-color': '#60a5fa',
        'target-arrow-shape': 'triangle',
        'curve-style': 'bezier',
        'opacity': 0.7
      }
    }
  ],
  
  elements: {
    nodes: socketData.nodes.map(node => ({
      data: {
        id: node.id,
        label: node.label,
        level: node.level,
        desc: node.desc,
        detailedDesc: node.detailedDesc || '',
        functions: node.functions || [],
        color: LEVEL_COLORS[node.level] || '#666'
      },
      position: node.position
    })),
    edges: socketData.edges.map(edge => ({
      data: {
        source: edge.source,
        target: edge.target
      }
    }))
  },
  
  layout: {
    name: 'preset'
  }
});

// ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸
const info = document.getElementById('info');
const zoomLevelDisplay = document.getElementById('zoom-level');

// ë ˆë²¨ë³„ í•œê¸€ ì´ë¦„
const levelNames = {
  'CORE': 'í•µì‹¬ ê°œë…',
  'HISTORY': 'ì—­ì‚¬',
  'KERNEL': 'ì»¤ë„ êµ¬ì¡°',
  'LIFECYCLE': 'ìƒëª…ì£¼ê¸°',
  'COMPARISON': 'ë¹„êµ'
};

// ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
function updateInfoPanel(node) {
  const level = node.data('level');
  const functions = node.data('functions') || [];
  
  let html = `
    <h3>${node.data('label')}</h3>
    <p><span class="level-badge" style="background: ${node.data('color')}; color: #fff;">${levelNames[level] || level}</span></p>
    <p class="desc"><strong>${node.data('desc')}</strong></p>
  `;
  
  const detailedDesc = node.data('detailedDesc');
  if (detailedDesc) {
    const formattedDesc = detailedDesc.replace(/\n/g, '<br>');
    html += `<p class="desc">${formattedDesc}</p>`;
  }
  
  if (functions.length > 0) {
    html += '<p class="desc"><strong>ê´€ë ¨ í•¨ìˆ˜/êµ¬ì¡°ì²´:</strong></p>';
    html += '<ul class="function-list">';
    functions.forEach(func => {
      html += `<li>${func}</li>`;
    });
    html += '</ul>';
  }
  
  info.innerHTML = html;
}

// ë…¸ë“œ í´ë¦­ ì´ë²¤íŠ¸
cy.on('tap', 'node', (evt) => {
  const node = evt.target;
  updateInfoPanel(node);
});

// ë°°ê²½ í´ë¦­ ì‹œ ì´ˆê¸° ë©”ì‹œì§€ í‘œì‹œ
cy.on('tap', (evt) => {
  if (evt.target === cy) {
    info.innerHTML = `
      <h3>Socketì´ë€ ë¬´ì—‡ì¸ê°€</h3>
      <p class="desc" style="margin-bottom: 12px;">
        <a href="index.html" style="color: #60a5fa; text-decoration: none; font-weight: bold; border-bottom: 1px solid #60a5fa; display: block; margin-bottom: 8px;">ë„¤íŠ¸ì›Œí¬ ë§µ</a>
        <a href="tutorial.html" style="color: #60a5fa; text-decoration: none; font-weight: bold; border-bottom: 1px solid #60a5fa; display: block;">ë„¤íŠ¸ì›Œí¬ ë§µ ì‹¤ìŠµ íŠœí† ë¦¬ì–¼</a>
        <a href="soket.html" style="color: #60a5fa; text-decoration: none; font-weight: bold; border-bottom: 1px solid #60a5fa; display: block; margin-bottom: 8px;">ì†Œì¼“ ë§µ</a>
      </p>
      <p class="desc"><strong>í•µì‹¬ ë©”ì‹œì§€:</strong></p>
      <p class="desc">ì†Œì¼“ì€ í†µì‹ ìš© íŒŒì¼ì´ ì•„ë‹ˆë¼ ì»¤ë„ ìƒíƒœ ë¨¸ì‹ ì˜ í•¸ë“¤ì…ë‹ˆë‹¤.</p>
      <p class="desc">ë…¸ë“œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
      <p class="desc">ë§ˆìš°ìŠ¤ íœ ë¡œ í™•ëŒ€/ì¶•ì†Œ, ë“œë˜ê·¸ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    `;
  }
});

// Zoom ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
cy.on('zoom', () => {
  const z = cy.zoom();
  zoomLevelDisplay.textContent = `Zoom: ${z.toFixed(2)}x`;
});

// í‚¤ë³´ë“œ ì´ë²¤íŠ¸
document.addEventListener('keydown', e => {
  const pan = cy.pan();
  const step = 80;
  const zoomStep = 0.2;

  switch (e.key) {
    case 'ArrowUp':
      cy.pan({ x: pan.x, y: pan.y + step });
      break;
    case 'ArrowDown':
      cy.pan({ x: pan.x, y: pan.y - step });
      break;
    case 'ArrowLeft':
      cy.pan({ x: pan.x + step, y: pan.y });
      break;
    case 'ArrowRight':
      cy.pan({ x: pan.x - step, y: pan.y });
      break;
    case '+':
    case '=':
      cy.zoom(cy.zoom() + zoomStep);
      break;
    case '-':
    case '_':
      cy.zoom(cy.zoom() - zoomStep);
      break;
    case 'Escape':
      cy.fit();
      break;
  }
});

// ì´ˆê¸° ì „ì²´ ë³´ê¸°
cy.ready(() => {
  cy.fit(50);
  zoomLevelDisplay.textContent = `Zoom: ${cy.zoom().toFixed(2)}x`;
});
</script>

</body>
</html>
