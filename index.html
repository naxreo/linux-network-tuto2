<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linux Network Flow Map</title>
  <script src="https://unpkg.com/cytoscape@3.26.0/dist/cytoscape.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      display: flex;
      height: 100vh;
      background: #0a0a0a;
      color: #e5e5e5;
      overflow: hidden;
    }

    #cy {
      flex: 1;
      background: #111;
      position: relative;
    }

    #info {
      width: 350px;
      padding: 20px;
      background: #1a1a1a;
      border-left: 1px solid #333;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    #info h3 {
      margin: 0 0 8px 0;
      color: #7dd3fc;
      font-size: 18px;
      border-bottom: 2px solid #2563eb;
      padding-bottom: 8px;
    }

    #info p {
      margin: 8px 0;
      line-height: 1.6;
      color: #d1d5db;
    }

    #info .desc {
      color: #9ca3af;
      font-size: 14px;
    }

    #info .function-list {
      margin-top: 12px;
      padding-left: 20px;
    }

    #info .function-list li {
      margin: 6px 0;
      color: #60a5fa;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }

    #info .level-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: bold;
      margin-right: 8px;
    }

    #controls {
      position: absolute;
      top: 20px;
      left: 20px;
      background: rgba(26, 26, 26, 0.9);
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #333;
      z-index: 1000;
    }

    #controls h4 {
      margin: 0 0 8px 0;
      color: #7dd3fc;
      font-size: 14px;
    }

    #controls .control-item {
      margin: 4px 0;
      font-size: 12px;
      color: #9ca3af;
    }

    #zoom-level {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(26, 26, 26, 0.9);
      padding: 8px 12px;
      border-radius: 6px;
      border: 1px solid #333;
      z-index: 1000;
      font-size: 12px;
      color: #60a5fa;
    }

    .legend {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid #333;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin: 8px 0;
      font-size: 12px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      margin-right: 8px;
    }
  </style>
</head>
<body>

<div id="cy"></div>

<div id="info">
  <h3>Node Info</h3>
  <p class="desc">ë…¸ë“œë¥¼ í´ë¦­í•˜ì—¬ ìƒì„¸ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.</p>
  <p class="desc">ë§ˆìš°ìŠ¤ íœ ë¡œ í™•ëŒ€/ì¶•ì†Œ, ë“œë˜ê·¸ë¡œ ì´ë™í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
</div>

<div id="controls">
  <h4>Controls</h4>
  <div class="control-item">ğŸ–±ï¸ ë“œë˜ê·¸: ì´ë™</div>
  <div class="control-item">ğŸ–±ï¸ íœ : í™•ëŒ€/ì¶•ì†Œ</div>
  <div class="control-item">âŒ¨ï¸ ë°©í–¥í‚¤: ì´ë™</div>
  <div class="control-item">âŒ¨ï¸ +/-: í™•ëŒ€/ì¶•ì†Œ</div>
  <div class="control-item">âŒ¨ï¸ ESC: ì „ì²´ ë³´ê¸°</div>
</div>

<div id="zoom-level">Zoom: 1.00x</div>

<script>
// Zoom ë ˆë²¨ ì •ì˜
const ZOOM_LEVEL = {
  OVERVIEW: 0.5,
  HOOK: 1.2,
  TABLE: 1.8,
  FUNCTION: 2.5
};

// ê³„ì¸µë³„ ìƒ‰ìƒ ì •ì˜
const LEVEL_COLORS = {
  HARDWARE: '#ef4444',      // NIC - ë¹¨ê°„ìƒ‰
  DRIVER: '#f97316',        // Driver - ì£¼í™©ìƒ‰
  KERNEL_LOW: '#eab308',    // NAPI, skb - ë…¸ë€ìƒ‰
  NETFILTER: '#8b5cf6',     // Netfilter - ë³´ë¼ìƒ‰
  ROUTING: '#06b6d4',       // Routing - ì²­ë¡ìƒ‰
  SOCKET: '#10b981',        // Socket - ì´ˆë¡ìƒ‰
  XDP: '#ec4899',           // XDP - í•‘í¬ìƒ‰
  TC: '#6366f1',            // TC/qdisc - ì¸ë””ê³ ìƒ‰
  BUFFER: '#14b8a6',        // Buffer - í‹¸ìƒ‰
  USER: '#f59e0b'           // User-space - ì•°ë²„ìƒ‰
};

// ë…¸ë“œ ë°ì´í„° êµ¬ì¡°
const networkData = {
  nodes: [
    // RX ê²½ë¡œ
    { 
      id: 'nic-rx', 
      label: 'NIC', 
      level: 'HARDWARE', 
      desc: 'ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¹´ë“œ',
      detailedDesc: 'ë¬¼ë¦¬ì  ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ ì¹´ë“œë¡œ, ì „ê¸° ì‹ í˜¸ë¥¼ ë°›ì•„ íŒ¨í‚·ì„ ìˆ˜ì‹ í•©ë‹ˆë‹¤. íŒ¨í‚·ì´ ë„ì°©í•˜ë©´ DMA(Direct Memory Access)ë¥¼ í†µí•´ ì»¤ë„ ë©”ëª¨ë¦¬ì˜ ring bufferì— íŒ¨í‚·ì„ ì§ì ‘ ì ì¬í•˜ê³ , í•˜ë“œì›¨ì–´ ì¸í„°ëŸ½íŠ¸ë¥¼ ë°œìƒì‹œì¼œ ì»¤ë„ì— íŒ¨í‚· ìˆ˜ì‹ ì„ ì•Œë¦½ë‹ˆë‹¤.',
      functions: ['interrupt handler'], 
      position: { x: 0, y: -200 } 
    },
    { 
      id: 'nic-rx-ring', 
      label: 'NIC RX Ring', 
      level: 'BUFFER', 
      desc: 'NIC ìˆ˜ì‹  ë§ ë²„í¼',
      detailedDesc: 'NIC í•˜ë“œì›¨ì–´ê°€ íŒ¨í‚·ì„ ìˆ˜ì‹ í•  ë•Œ DMAë¥¼ í†µí•´ ì»¤ë„ ë©”ëª¨ë¦¬ì— ì§ì ‘ ì ì¬í•˜ëŠ” ë§ ë²„í¼ì…ë‹ˆë‹¤. ë“œë¼ì´ë²„ê°€ ë¯¸ë¦¬ í• ë‹¹í•œ ë©”ëª¨ë¦¬ ì˜ì—­ìœ¼ë¡œ, í•˜ë“œì›¨ì–´ê°€ ì§ì ‘ ì ‘ê·¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. íŒ¨í‚·ì´ ë„ì°©í•˜ë©´ ì´ ë²„í¼ì— ì €ì¥ë˜ê³ , ë“œë¼ì´ë²„ê°€ ì´ë¥¼ ì½ì–´ì„œ ì²˜ë¦¬í•©ë‹ˆë‹¤. ë§ ë²„í¼ëŠ” ìˆœí™˜ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆì–´ ê³ ì† íŒ¨í‚· ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
      functions: ['DMA', 'ring buffer descriptor'], 
      position: { x: 100, y: -150 } 
    },
    { 
      id: 'driver-rx', 
      label: 'Driver', 
      level: 'DRIVER', 
      desc: 'ë„¤íŠ¸ì›Œí¬ ì¹´ë“œ ë“œë¼ì´ë²„',
      detailedDesc: 'NIC í•˜ë“œì›¨ì–´ì™€ ì»¤ë„ ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒì„ ì—°ê²°í•˜ëŠ” ë“œë¼ì´ë²„ì…ë‹ˆë‹¤. ì¸í„°ëŸ½íŠ¸ í•¸ë“¤ëŸ¬ì—ì„œ íŒ¨í‚· ìˆ˜ì‹ ì„ ê°ì§€í•˜ë©´, NAPI(New API) ìŠ¤ì¼€ì¤„ë§ì„ í†µí•´ ì¸í„°ëŸ½íŠ¸ ê¸°ë°˜ ì²˜ë¦¬ë¥¼ í´ë§ ê¸°ë°˜ìœ¼ë¡œ ì „í™˜í•©ë‹ˆë‹¤. ì´ëŠ” ê³ ì† ë„¤íŠ¸ì›Œí¬ì—ì„œ ì¸í„°ëŸ½íŠ¸ í­ì£¼ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤.',
      functions: ['napi_schedule()', 'driver_poll()'], 
      position: { x: 200, y: -200 } 
    },
    { 
      id: 'napi-rx', 
      label: 'NAPI', 
      level: 'KERNEL_LOW', 
      desc: 'ì¸í„°ëŸ½íŠ¸ â†’ í´ë§ ì „í™˜',
      detailedDesc: 'NAPI(New API)ëŠ” ê³ ì† ë„¤íŠ¸ì›Œí¬ í™˜ê²½ì—ì„œ ì¸í„°ëŸ½íŠ¸ í­ì£¼ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•œ ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. ì´ˆê¸° ì¸í„°ëŸ½íŠ¸ í›„ì—ëŠ” í´ë§ ëª¨ë“œë¡œ ì „í™˜ë˜ì–´ ì—¬ëŸ¬ íŒ¨í‚·ì„ í•œ ë²ˆì— ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ëŠ” CPU íš¨ìœ¨ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚µë‹ˆë‹¤. struct napi_struct êµ¬ì¡°ì²´ë¡œ ê´€ë¦¬ë˜ë©°, GRO(Generic Receive Offload)ì™€ í•¨ê»˜ ì‘ë™í•˜ì—¬ íŒ¨í‚·ì„ íš¨ìœ¨ì ìœ¼ë¡œ ì²˜ë¦¬í•©ë‹ˆë‹¤.',
      functions: ['napi_poll()', 'napi_gro_receive()'], 
      position: { x: 400, y: -200 } 
    },
    { 
      id: 'xdp-rx', 
      label: 'XDP', 
      level: 'XDP', 
      desc: 'eBPF ê¸°ë°˜ ë“œë¼ì´ë²„ ë ˆë²¨ ì²˜ë¦¬ (ì˜µì…˜)',
      detailedDesc: 'XDP(eXpress Data Path)ëŠ” eBPF í”„ë¡œê·¸ë¨ì„ ì‚¬ìš©í•˜ì—¬ ë“œë¼ì´ë²„ ë ˆë²¨ì—ì„œ ë§¤ìš° ë¹ ë¥¸ íŒ¨í‚· ì²˜ë¦¬ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•©ë‹ˆë‹¤. skb ìƒì„± ì´ì „ ë˜ëŠ” ì§í›„ì— ì‹¤í–‰ë˜ë©°, Netfilterë³´ë‹¤ ë¨¼ì € ì²˜ë¦¬ë©ë‹ˆë‹¤. DROP(íŒ¨í‚· íê¸°), PASS(í†µê³¼), TX(ì¬ì „ì†¡), REDIRECT(ë‹¤ë¥¸ ì¸í„°í˜ì´ìŠ¤ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸) ë“±ì˜ ì•¡ì…˜ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. DDoS ë°©ì–´, ë¡œë“œ ë°¸ëŸ°ì‹±, íŒ¨í‚· í•„í„°ë§ ë“±ì— ì‚¬ìš©ë©ë‹ˆë‹¤.',
      functions: ['bpf_prog_run_xdp()', 'xdp_do_redirect()'], 
      position: { x: 300, y: -100 } 
    },
    { 
      id: 'skb-rx', 
      label: 'sk_buff', 
      level: 'KERNEL_LOW', 
      desc: 'íŒ¨í‚· ë©”íƒ€ë°ì´í„° êµ¬ì¡°ì²´',
      detailedDesc: 'sk_buff(socket buffer)ëŠ” ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì—ì„œ ëª¨ë“  ë„¤íŠ¸ì›Œí¬ íŒ¨í‚·ì„ í‘œí˜„í•˜ëŠ” í•µì‹¬ ë°ì´í„° êµ¬ì¡°ì…ë‹ˆë‹¤. íŒ¨í‚· ë°ì´í„°ì™€ ë©”íƒ€ë°ì´í„°(í”„ë¡œí† ì½œ, ê¸¸ì´, ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤, ë¼ìš°íŒ… ì •ë³´ ë“±)ë¥¼ í¬í•¨í•©ë‹ˆë‹¤. ì´ êµ¬ì¡°ì²´ëŠ” ë„¤íŠ¸ì›Œí¬ ìŠ¤íƒ ì „ì²´ë¥¼ í†µê³¼í•˜ë©°, ê° ê³„ì¸µì—ì„œ í•„ìš”í•œ ì •ë³´ë¥¼ ì¶”ê°€í•˜ê±°ë‚˜ ìˆ˜ì •í•©ë‹ˆë‹¤. ì£¼ìš” í•„ë“œë¡œëŠ” skb->data(íŒ¨í‚· ë°ì´í„°), skb->len(ê¸¸ì´), skb->protocol(í”„ë¡œí† ì½œ), skb->dev(ë„¤íŠ¸ì›Œí¬ ì¥ì¹˜) ë“±ì´ ìˆìŠµë‹ˆë‹¤.',
      functions: ['build_skb()', 'netif_receive_skb()'], 
      position: { x: 600, y: -200 } 
    },
    { 
      id: 'netfilter-rx', 
      label: 'Netfilter', 
      level: 'NETFILTER', 
      desc: 'íŒ¨í‚· í•„í„°ë§ ë° NAT',
      detailedDesc: 'NetfilterëŠ” ë¦¬ëˆ…ìŠ¤ ì»¤ë„ì˜ íŒ¨í‚· í•„í„°ë§ ë° NAT(Network Address Translation) í”„ë ˆì„ì›Œí¬ì…ë‹ˆë‹¤. iptablesì™€ nftablesì˜ ê¸°ë°˜ì´ ë˜ëŠ” ì¸í”„ë¼ë¡œ, ì—¬ëŸ¬ hook ì§€ì ì—ì„œ íŒ¨í‚·ì„ ê°€ë¡œì±„ ì²˜ë¦¬í•©ë‹ˆë‹¤. PREROUTING, INPUT, FORWARD, OUTPUT, POSTROUTINGì˜ 5ê°€ì§€ hook ì§€ì ì—ì„œ íŒ¨í‚·ì„ ê²€ì‚¬í•˜ê³ , conntrack(ì—°ê²° ì¶”ì ), NAT, í•„í„°ë§, mangling ë“±ì˜ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.',
      functions: ['nf_hook_slow()'], 
      position: { x: 800, y: -200 } 
    },
    { 
      id: 'routing-rx', 
      label: 'Routing', 
      level: 'ROUTING', 
      desc: 'ë¼ìš°íŒ… í…Œì´ë¸” ì¡°íšŒ',
      detailedDesc: 'ë¼ìš°íŒ… ê²°ì • ë‹¨ê³„ì—ì„œëŠ” FIB(Forwarding Information Base)ë¥¼ ì¡°íšŒí•˜ì—¬ íŒ¨í‚·ì˜ ëª©ì ì§€ê°€ ë¡œì»¬ ì‹œìŠ¤í…œì¸ì§€, ë‹¤ë¥¸ í˜¸ìŠ¤íŠ¸ë¡œ í¬ì›Œë”©í•´ì•¼ í•˜ëŠ”ì§€ ê²°ì •í•©ë‹ˆë‹¤. ip_route_input_noref() í•¨ìˆ˜ê°€ ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì¡°íšŒí•˜ê³ , ê²°ê³¼ì— ë”°ë¼ ë¡œì»¬ ìˆ˜ì‹ (INPUT) ë˜ëŠ” í¬ì›Œë”©(FORWARD) ê²½ë¡œë¡œ ë¶„ê¸°í•©ë‹ˆë‹¤. ë¼ìš°íŒ… ê²°ì • í›„ì—ëŠ” íŒ¨í‚·ì˜ ëª©ì ì§€ ì¸í„°í˜ì´ìŠ¤ì™€ ê²Œì´íŠ¸ì›¨ì´ ì •ë³´ê°€ skbì— ì„¤ì •ë©ë‹ˆë‹¤.',
      functions: ['ip_route_input_noref()', 'ip_rcv_finish()'], 
      position: { x: 1000, y: -200 } 
    },
    { 
      id: 'socket-rx', 
      label: 'Socket', 
      level: 'SOCKET', 
      desc: 'User-space ì „ë‹¬',
      detailedDesc: 'Socket ê³„ì¸µì—ì„œëŠ” L4(ì „ì†¡ ê³„ì¸µ) í”„ë¡œí† ì½œ(TCP/UDP ë“±)ì— ë”°ë¼ íŒ¨í‚·ì„ ì²˜ë¦¬í•˜ê³ , í•´ë‹¹í•˜ëŠ” ì†Œì¼“ì˜ ìˆ˜ì‹  í(sk_receive_queue)ì— íŒ¨í‚·ì„ ì¶”ê°€í•©ë‹ˆë‹¤. TCPì˜ ê²½ìš° tcp_v4_rcv()ì—ì„œ íŒ¨í‚·ì„ ê²€ì¦í•˜ê³ , ì—°ê²° ìƒíƒœì— ë”°ë¼ ì²˜ë¦¬í•œ í›„ ì†Œì¼“ íì— ì¶”ê°€í•©ë‹ˆë‹¤. íŒ¨í‚·ì´ íì— ì¶”ê°€ë˜ë©´ sk_data_ready()ë¥¼ í˜¸ì¶œí•˜ì—¬ ëŒ€ê¸° ì¤‘ì¸ ì‚¬ìš©ì ê³µê°„ í”„ë¡œì„¸ìŠ¤ë¥¼ ê¹¨ì›ë‹ˆë‹¤(wakeup). ì‚¬ìš©ì ê³µê°„ì˜ recv() ì‹œìŠ¤í…œ ì½œì´ ì´ íì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ê°‘ë‹ˆë‹¤.',
      functions: ['tcp_v4_rcv()', 'sock_queue_rcv_skb()', 'sk_data_ready()'], 
      position: { x: 1200, y: -200 } 
    },
    { 
      id: 'tcp-rx-buffer', 
      label: 'TCP RX Buffer', 
      level: 'BUFFER', 
      desc: 'TCP ìˆ˜ì‹  ë²„í¼',
      detailedDesc: 'TCP ìˆ˜ì‹  ë²„í¼ëŠ” TCP í”„ë¡œí† ì½œì´ ìˆ˜ì‹ í•œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë²„í¼ì…ë‹ˆë‹¤. ìˆœì„œê°€ ë§ì§€ ì•Šì€ íŒ¨í‚·ì„ ì¬ì •ë ¬í•˜ê±°ë‚˜, ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì½ì„ ë•Œê¹Œì§€ ë°ì´í„°ë¥¼ ë³´ê´€í•©ë‹ˆë‹¤. ì´ ë²„í¼ì˜ í¬ê¸°ëŠ” SO_RCVBUF ì†Œì¼“ ì˜µì…˜ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìœ¼ë©°, TCP íë¦„ ì œì–´ì™€ í˜¼ì¡ ì œì–´ì— ì¤‘ìš”í•œ ì—­í• ì„ í•©ë‹ˆë‹¤.',
      functions: ['tcp_rcv_established()', 'tcp_data_queue()'], 
      position: { x: 1200, y: -150 } 
    },
    { 
      id: 'socket-rx-queue', 
      label: 'Socket RX Queue', 
      level: 'BUFFER', 
      desc: 'ì†Œì¼“ ìˆ˜ì‹  í',
      detailedDesc: 'ì†Œì¼“ì˜ ìˆ˜ì‹  í(sk_receive_queue)ëŠ” ì»¤ë„ì—ì„œ ì‚¬ìš©ì ê³µê°„ìœ¼ë¡œ ì „ë‹¬ë  íŒ¨í‚·ì„ ì €ì¥í•˜ëŠ” íì…ë‹ˆë‹¤. TCP/UDP ë“± í”„ë¡œí† ì½œ ê³„ì¸µì—ì„œ ì²˜ë¦¬ëœ íŒ¨í‚·ì´ ì´ íì— ì¶”ê°€ë˜ê³ , ì‚¬ìš©ì ê³µê°„ì˜ recv(), read() ë“±ì˜ ì‹œìŠ¤í…œ ì½œì´ ì´ íì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ê°‘ë‹ˆë‹¤. íê°€ ë¹„ì–´ìˆìœ¼ë©´ í”„ë¡œì„¸ìŠ¤ê°€ ë¸”ë¡œí‚¹ë˜ê³ , ë°ì´í„°ê°€ ë„ì°©í•˜ë©´ wakeup ì‹ í˜¸ë¥¼ ë°›ì•„ ê¹¨ì–´ë‚©ë‹ˆë‹¤.',
      functions: ['sock_queue_rcv_skb()', 'skb_queue_tail()', 'sk_data_ready()'], 
      position: { x: 1350, y: -200 } 
    },
    { 
      id: 'user-rx', 
      label: 'User Application', 
      level: 'USER', 
      desc: 'ì‚¬ìš©ì ê³µê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ (RX)',
      detailedDesc: 'ì‚¬ìš©ì ê³µê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ recv(), read(), recvfrom() ë“±ì˜ ì‹œìŠ¤í…œ ì½œì„ í˜¸ì¶œí•˜ì—¬ ì†Œì¼“ì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì‹ í•©ë‹ˆë‹¤. ì»¤ë„ì˜ ì†Œì¼“ ìˆ˜ì‹  íì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ì™€ ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„í¼ë¡œ ë³µì‚¬í•©ë‹ˆë‹¤. íê°€ ë¹„ì–´ìˆìœ¼ë©´ í”„ë¡œì„¸ìŠ¤ê°€ ë¸”ë¡œí‚¹ë˜ê³ , ë°ì´í„°ê°€ ë„ì°©í•˜ë©´ wakeup ì‹ í˜¸ë¥¼ ë°›ì•„ ê¹¨ì–´ë‚˜ ë°ì´í„°ë¥¼ ì½ì–´ê°‘ë‹ˆë‹¤.',
      functions: ['recv()', 'read()', 'recvfrom()'], 
      position: { x: 1500, y: -200 } 
    },
    
    // Netfilter Hook ì„¸ë¶€
    { 
      id: 'nf:prerouting', 
      label: 'PREROUTING', 
      level: 'NETFILTER', 
      desc: 'ë¼ìš°íŒ… ì „ ì²˜ë¦¬',
      detailedDesc: 'PREROUTING hookì€ ë¼ìš°íŒ… ê²°ì • ì´ì „ì— ì‹¤í–‰ë˜ëŠ” ì²« ë²ˆì§¸ Netfilter hookì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ ì£¼ë¡œ DNAT(Destination NAT)ì™€ conntrack(ì—°ê²° ì¶”ì )ì´ ì‹œì‘ë©ë‹ˆë‹¤. íŒ¨í‚·ì˜ ëª©ì ì§€ ì£¼ì†Œë¥¼ ë³€ê²½í•˜ê±°ë‚˜, ì—°ê²° ì¶”ì  í…Œì´ë¸”ì— ì—°ê²° ì •ë³´ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤. ì´ hookì€ ëª¨ë“  ë“¤ì–´ì˜¤ëŠ” íŒ¨í‚·ì— ëŒ€í•´ ì‹¤í–‰ë˜ë©°, NF_INET_PRE_ROUTING hook pointì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.',
      functions: ['nf_hook_slow()', 'ipv4_conntrack_in()'], 
      parent: 'netfilter-rx', 
      position: { x: 750, y: -300 } 
    },
    { 
      id: 'nf:input', 
      label: 'INPUT', 
      level: 'NETFILTER', 
      desc: 'ë¡œì»¬ ëª©ì ì§€ ì²˜ë¦¬',
      detailedDesc: 'INPUT hookì€ ë¡œì»¬ ì‹œìŠ¤í…œìœ¼ë¡œ í–¥í•˜ëŠ” íŒ¨í‚·ì— ëŒ€í•´ì„œë§Œ ì‹¤í–‰ë©ë‹ˆë‹¤. ë¼ìš°íŒ… ê²°ì • í›„ íŒ¨í‚·ì˜ ëª©ì ì§€ê°€ ë¡œì»¬ì¸ ê²½ìš°, ì´ hookì—ì„œ íŒ¨í‚· í•„í„°ë§ ê·œì¹™ì„ ì ìš©í•©ë‹ˆë‹¤. ë°©í™”ë²½ ê·œì¹™, ë¡œê¹…, íŒ¨í‚· ë“œë¡­ ë“±ì˜ ì‘ì—…ì´ ì—¬ê¸°ì„œ ìˆ˜í–‰ë©ë‹ˆë‹¤. NF_INET_LOCAL_IN hook pointì—ì„œ ì²˜ë¦¬ë˜ë©°, ip_local_deliver() í•¨ìˆ˜ê°€ ì´ hookì„ í˜¸ì¶œí•©ë‹ˆë‹¤.',
      functions: ['ip_local_deliver()', 'nf_hook()'], 
      parent: 'netfilter-rx', 
      position: { x: 850, y: -300 } 
    },
    { 
      id: 'nf:forward', 
      label: 'FORWARD', 
      level: 'NETFILTER', 
      desc: 'í¬ì›Œë”© ì²˜ë¦¬',
      detailedDesc: 'FORWARD hookì€ ë¼ìš°í„° ì—­í• ì„ í•˜ëŠ” ì‹œìŠ¤í…œì—ì„œ, í•œ ì¸í„°í˜ì´ìŠ¤ë¡œ ë“¤ì–´ì˜¨ íŒ¨í‚·ì„ ë‹¤ë¥¸ ì¸í„°í˜ì´ìŠ¤ë¡œ ì „ë‹¬í•  ë•Œ ì‹¤í–‰ë©ë‹ˆë‹¤. ë¡œì»¬ ì‹œìŠ¤í…œì´ ëª©ì ì§€ê°€ ì•„ë‹Œ íŒ¨í‚·ì— ëŒ€í•´ í¬ì›Œë”© ê·œì¹™ì„ ì ìš©í•©ë‹ˆë‹¤. ì´ hookì—ì„œë„ íŒ¨í‚· í•„í„°ë§, ë¡œê¹… ë“±ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤. NF_INET_FORWARD hook pointì—ì„œ ì²˜ë¦¬ë˜ë©°, ip_forward() í•¨ìˆ˜ê°€ ì´ hookì„ í˜¸ì¶œí•©ë‹ˆë‹¤.',
      functions: ['ip_forward()', 'nf_hook()'], 
      parent: 'netfilter-rx', 
      position: { x: 750, y: -100 } 
    },
    
    // TX ê²½ë¡œ
    { 
      id: 'user-tx', 
      label: 'User Application', 
      level: 'USER', 
      desc: 'ì‚¬ìš©ì ê³µê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ (TX)',
      detailedDesc: 'ì‚¬ìš©ì ê³µê°„ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ send(), sendto(), write() ë“±ì˜ ì‹œìŠ¤í…œ ì½œì„ í˜¸ì¶œí•˜ì—¬ ë„¤íŠ¸ì›Œí¬ë¡œ ë°ì´í„°ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ë²„í¼ì˜ ë°ì´í„°ê°€ ì»¤ë„ ê³µê°„ìœ¼ë¡œ ë³µì‚¬ë˜ê³ , ì†Œì¼“ì˜ ì†¡ì‹  íì— ì¶”ê°€ë©ë‹ˆë‹¤. íê°€ ê°€ë“ ì°¨ë©´ í”„ë¡œì„¸ìŠ¤ê°€ ë¸”ë¡œí‚¹ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      functions: ['send()', 'sendto()', 'write()'], 
      position: { x: -300, y: 200 } 
    },
    { 
      id: 'socket-tx', 
      label: 'Socket', 
      level: 'SOCKET', 
      desc: 'User-spaceì—ì„œ ì „ì†¡',
      detailedDesc: 'ì‚¬ìš©ì ê³µê°„ì—ì„œ send(), sendto(), write() ë“±ì˜ ì‹œìŠ¤í…œ ì½œì„ í˜¸ì¶œí•˜ë©´, ì»¤ë„ì˜ __sys_sendto() í•¨ìˆ˜ê°€ í˜¸ì¶œë©ë‹ˆë‹¤. ì´ í•¨ìˆ˜ëŠ” sock_sendmsg()ë¥¼ í†µí•´ ì†Œì¼“ì— ë°ì´í„°ë¥¼ ì „ë‹¬í•©ë‹ˆë‹¤. ì´ ì‹œì ì—ì„œ ì‚¬ìš©ì ê³µê°„ì˜ ë°ì´í„° ë²„í¼ê°€ ì»¤ë„ ê³µê°„ìœ¼ë¡œ ë³µì‚¬ë˜ê³ , ì†Œì¼“ì˜ ì „ì†¡ íì— ì¶”ê°€ë©ë‹ˆë‹¤.',
      functions: ['__sys_sendto()', 'sock_sendmsg()'], 
      position: { x: 0, y: 200 } 
    },
    { 
      id: 'socket-tx-queue', 
      label: 'Socket TX Queue', 
      level: 'BUFFER', 
      desc: 'ì†Œì¼“ ì†¡ì‹  í',
      detailedDesc: 'ì†Œì¼“ì˜ ì†¡ì‹  í(sk_write_queue)ëŠ” ì‚¬ìš©ì ê³µê°„ì—ì„œ ì „ì†¡ ìš”ì²­ëœ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” íì…ë‹ˆë‹¤. send(), sendto() ë“±ì˜ ì‹œìŠ¤í…œ ì½œë¡œ ì „ë‹¬ëœ ë°ì´í„°ê°€ ì´ íì— ì¶”ê°€ë˜ê³ , TCP/IP ê³„ì¸µì—ì„œ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬ë©ë‹ˆë‹¤. íê°€ ê°€ë“ ì°¨ë©´ í”„ë¡œì„¸ìŠ¤ê°€ ë¸”ë¡œí‚¹ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      functions: ['sock_alloc_send_skb()', 'skb_queue_tail()'], 
      position: { x: -150, y: 200 } 
    },
    { 
      id: 'tcp-tx-buffer', 
      label: 'TCP TX Buffer', 
      level: 'BUFFER', 
      desc: 'TCP ì†¡ì‹  ë²„í¼',
      detailedDesc: 'TCP ì†¡ì‹  ë²„í¼ëŠ” TCP í”„ë¡œí† ì½œì´ ì „ì†¡í•  ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë²„í¼ì…ë‹ˆë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì „ì†¡ ìš”ì²­í•œ ë°ì´í„°ê°€ ì´ ë²„í¼ì— ì €ì¥ë˜ê³ , TCP íë¦„ ì œì–´ì™€ í˜¼ì¡ ì œì–´ ì•Œê³ ë¦¬ì¦˜ì— ë”°ë¼ ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë¶„í• ë˜ì–´ ì „ì†¡ë©ë‹ˆë‹¤. ì´ ë²„í¼ì˜ í¬ê¸°ëŠ” SO_SNDBUF ì†Œì¼“ ì˜µì…˜ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìœ¼ë©°, ë²„í¼ê°€ ê°€ë“ ì°¨ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¸”ë¡œí‚¹ë©ë‹ˆë‹¤.',
      functions: ['tcp_sendmsg()', 'tcp_write_xmit()'], 
      position: { x: 200, y: 250 } 
    },
    { 
      id: 'tcp-tx', 
      label: 'TCP/IP', 
      level: 'SOCKET', 
      desc: 'TCP/IP ì²˜ë¦¬',
      detailedDesc: 'TCP ê³„ì¸µì—ì„œëŠ” tcp_sendmsg()ê°€ í˜¸ì¶œë˜ì–´ ë°ì´í„°ë¥¼ TCP ì„¸ê·¸ë¨¼íŠ¸ë¡œ ë¶„í• í•©ë‹ˆë‹¤. TCP í—¤ë”ë¥¼ ì¶”ê°€í•˜ê³ , íë¦„ ì œì–´, í˜¼ì¡ ì œì–´ ì•Œê³ ë¦¬ì¦˜ì„ ì ìš©í•©ë‹ˆë‹¤. ê·¸ í›„ IP ê³„ì¸µìœ¼ë¡œ ì „ë‹¬í•˜ê¸° ìœ„í•´ ip_queue_xmit()ì„ í˜¸ì¶œí•©ë‹ˆë‹¤. ì—¬ê¸°ì„œ IP í—¤ë”ê°€ ì¶”ê°€ë˜ê³ , í•„ìš”ì‹œ IP fragmentationì´ ìˆ˜í–‰ë©ë‹ˆë‹¤.',
      functions: ['tcp_sendmsg()', 'tcp_push()', 'ip_queue_xmit()'], 
      position: { x: 200, y: 200 } 
    },
    { 
      id: 'netfilter-tx-out', 
      label: 'Netfilter OUTPUT', 
      level: 'NETFILTER', 
      desc: 'ì¶œë ¥ ì „ í•„í„°ë§',
      detailedDesc: 'OUTPUT hookì€ ë¡œì»¬ ì‹œìŠ¤í…œì—ì„œ ìƒì„±ëœ íŒ¨í‚·ì´ ë„¤íŠ¸ì›Œí¬ë¡œ ë‚˜ê°€ê¸° ì „ì— ì‹¤í–‰ë©ë‹ˆë‹¤. ì—¬ê¸°ì„œ SNAT(Source NAT)ì˜ ì¼ë¶€ì™€ ë°©í™”ë²½ ê·œì¹™ì´ ì ìš©ë©ë‹ˆë‹¤. ë¡œì»¬ì—ì„œ ìƒì„±ëœ íŒ¨í‚·ì— ëŒ€í•œ í•„í„°ë§ê³¼ NAT ë³€í™˜ì´ ìˆ˜í–‰ë©ë‹ˆë‹¤. NF_INET_LOCAL_OUT hook pointì—ì„œ ì²˜ë¦¬ë˜ë©°, ip_local_out() í•¨ìˆ˜ê°€ ì´ hookì„ í˜¸ì¶œí•©ë‹ˆë‹¤.',
      functions: ['nf_hook()', 'ipv4_conntrack_local()', 'ip_local_out()'], 
      position: { x: 400, y: 200 } 
    },
    { 
      id: 'routing-tx', 
      label: 'Routing', 
      level: 'ROUTING', 
      desc: 'ì¶œë ¥ ë¼ìš°íŒ…',
      detailedDesc: 'ì¶œë ¥ ë¼ìš°íŒ…ì—ì„œëŠ” ip_route_output_flow() í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì–´ íŒ¨í‚·ì˜ ëª©ì ì§€ì— ëŒ€í•œ ìµœì ì˜ ê²½ë¡œë¥¼ ê²°ì •í•©ë‹ˆë‹¤. ë¼ìš°íŒ… í…Œì´ë¸”ì„ ì¡°íšŒí•˜ì—¬ ë‹¤ìŒ í™‰(next hop) ì£¼ì†Œì™€ ì¶œë ¥ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê²°ì •í•©ë‹ˆë‹¤. ì´ ì •ë³´ëŠ” skbì— ì €ì¥ë˜ì–´ ì´í›„ ë‹¨ê³„ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.',
      functions: ['ip_route_output_flow()'], 
      position: { x: 600, y: 200 } 
    },
    { 
      id: 'netfilter-tx-post', 
      label: 'Netfilter POSTROUTING', 
      level: 'NETFILTER', 
      desc: 'ë¼ìš°íŒ… í›„ ì²˜ë¦¬',
      detailedDesc: 'POSTROUTING hookì€ ë¼ìš°íŒ… ê²°ì • í›„, íŒ¨í‚·ì´ ì‹¤ì œë¡œ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¡œ ì „ì†¡ë˜ê¸° ì§ì „ì— ì‹¤í–‰ë˜ëŠ” ë§ˆì§€ë§‰ Netfilter hookì…ë‹ˆë‹¤. ì—¬ê¸°ì„œ SNAT(Source NAT)ì˜ ìµœì¢… ë‹¨ê³„ê°€ ìˆ˜í–‰ë˜ê³ , íŒ¨í‚·ì˜ ì†ŒìŠ¤ ì£¼ì†Œê°€ ë³€ê²½ë©ë‹ˆë‹¤. ë˜í•œ ë§ˆì§€ë§‰ ë°©í™”ë²½ ì²´í¬ì™€ íŒ¨í‚· manglingì´ ìˆ˜í–‰ë©ë‹ˆë‹¤. NF_INET_POST_ROUTING hook pointì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.',
      functions: ['nf_hook()', 'ip_finish_output()'], 
      position: { x: 800, y: 200 } 
    },
    { 
      id: 'tc-tx', 
      label: 'qdisc / TC', 
      level: 'TC', 
      desc: 'íŠ¸ë˜í”½ ì œì–´',
      detailedDesc: 'qdisc(Queueing Discipline)ì™€ TC(Traffic Control)ëŠ” íŒ¨í‚· ì „ì†¡ì„ ì œì–´í•˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì…ë‹ˆë‹¤. dev_queue_xmit() í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ë©´, ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ì— ì—°ê²°ëœ qdiscê°€ íŒ¨í‚·ì„ íì— ì¶”ê°€í•˜ê±°ë‚˜ ì¦‰ì‹œ ì „ì†¡í•©ë‹ˆë‹¤. ë‹¤ì–‘í•œ qdisc ì•Œê³ ë¦¬ì¦˜(fq, cake, pfifo_fast ë“±)ì´ ì‚¬ìš©ë  ìˆ˜ ìˆìœ¼ë©°, íŠ¸ë˜í”½ shaping(ëŒ€ì—­í­ ì œí•œ), policing(íŠ¸ë˜í”½ ì œí•œ), ìŠ¤ì¼€ì¤„ë§ ë“±ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. eBPF TC hookë„ ì—¬ê¸°ì„œ ì‹¤í–‰ë˜ì–´ ì»¤ìŠ¤í…€ íŒ¨í‚· ì²˜ë¦¬ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
      functions: ['dev_queue_xmit()', 'qdisc_run()', 'tc_classify()'], 
      position: { x: 1000, y: 200 } 
    },
    { 
      id: 'qdisc-queue', 
      label: 'qdisc Queue', 
      level: 'BUFFER', 
      desc: 'qdisc í',
      detailedDesc: 'qdisc íëŠ” íŠ¸ë˜í”½ ì œì–´ë¥¼ ìœ„í•´ íŒ¨í‚·ì„ ì„ì‹œë¡œ ì €ì¥í•˜ëŠ” íì…ë‹ˆë‹¤. dev_queue_xmit()ì—ì„œ íŒ¨í‚·ì´ ë„ì°©í•˜ë©´, ì„¤ì •ëœ qdisc ì•Œê³ ë¦¬ì¦˜ì— ë”°ë¼ íŒ¨í‚·ì´ íì— ì¶”ê°€ë˜ê±°ë‚˜ ì¦‰ì‹œ ì „ì†¡ë©ë‹ˆë‹¤. íì˜ í¬ê¸°ì™€ ë™ì‘ ë°©ì‹ì€ qdisc íƒ€ì…ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. pfifo_fastëŠ” ë‹¨ìˆœ FIFO, fqëŠ” ê³µì • íì‰, cakeëŠ” ê³ ê¸‰ íŠ¸ë˜í”½ ì œì–´ë¥¼ ì œê³µí•©ë‹ˆë‹¤. íê°€ ê°€ë“ ì°¨ë©´ íŒ¨í‚·ì´ ë“œë¡­ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      functions: ['qdisc_enqueue()', 'qdisc_dequeue()', 'qdisc_run()'], 
      position: { x: 1000, y: 250 } 
    },
    { 
      id: 'driver-tx', 
      label: 'Driver', 
      level: 'DRIVER', 
      desc: 'ë“œë¼ì´ë²„ ì „ì†¡',
      detailedDesc: 'ë“œë¼ì´ë²„ì˜ ndo_start_xmit() í•¨ìˆ˜ê°€ í˜¸ì¶œë˜ì–´ íŒ¨í‚·ì„ NIC í•˜ë“œì›¨ì–´ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ë“œë¼ì´ë²„ëŠ” íŒ¨í‚·ì„ í•˜ë“œì›¨ì–´ê°€ ì´í•´í•  ìˆ˜ ìˆëŠ” í˜•íƒœë¡œ ë³€í™˜í•˜ê³ , DMAë¥¼ í†µí•´ NICì˜ ì „ì†¡ ë²„í¼ì— íŒ¨í‚·ì„ ë³µì‚¬í•©ë‹ˆë‹¤. ì „ì†¡ ì™„ë£Œ í›„ì—ëŠ” í•˜ë“œì›¨ì–´ ì¸í„°ëŸ½íŠ¸ë¥¼ í†µí•´ ì»¤ë„ì— ì•Œë¦½ë‹ˆë‹¤.',
      functions: ['ndo_start_xmit()', 'netdev_start_xmit()'], 
      position: { x: 1200, y: 200 } 
    },
    { 
      id: 'nic-tx-ring', 
      label: 'NIC TX Ring', 
      level: 'BUFFER', 
      desc: 'NIC ì†¡ì‹  ë§ ë²„í¼',
      detailedDesc: 'NIC í•˜ë“œì›¨ì–´ì˜ ì „ì†¡ ë§ ë²„í¼ëŠ” ë“œë¼ì´ë²„ê°€ ì „ì†¡í•  íŒ¨í‚·ì„ ì €ì¥í•˜ëŠ” í•˜ë“œì›¨ì–´ ë²„í¼ì…ë‹ˆë‹¤. ë“œë¼ì´ë²„ê°€ íŒ¨í‚·ì„ ì´ ë²„í¼ì— DMAë¡œ ë³µì‚¬í•˜ë©´, NIC í•˜ë“œì›¨ì–´ê°€ ìë™ìœ¼ë¡œ íŒ¨í‚·ì„ ë„¤íŠ¸ì›Œí¬ ì¼€ì´ë¸”ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ë§ ë²„í¼ëŠ” ìˆœí™˜ êµ¬ì¡°ë¡œ ë˜ì–´ ìˆì–´ ì—°ì†ì ì¸ íŒ¨í‚· ì „ì†¡ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì „ì†¡ ì™„ë£Œ í›„ í•˜ë“œì›¨ì–´ ì¸í„°ëŸ½íŠ¸ë¥¼ í†µí•´ ë“œë¼ì´ë²„ì— ì•Œë¦½ë‹ˆë‹¤.',
      functions: ['DMA', 'ring buffer descriptor'], 
      position: { x: 1300, y: 250 } 
    },
    { 
      id: 'nic-tx', 
      label: 'NIC', 
      level: 'HARDWARE', 
      desc: 'ë„¤íŠ¸ì›Œí¬ ì¹´ë“œë¡œ ì „ì†¡',
      detailedDesc: 'NIC í•˜ë“œì›¨ì–´ëŠ” DMAë¥¼ í†µí•´ ì»¤ë„ ë©”ëª¨ë¦¬ì—ì„œ íŒ¨í‚· ë°ì´í„°ë¥¼ ì½ì–´ì™€ ë¬¼ë¦¬ì  ë„¤íŠ¸ì›Œí¬ ì¼€ì´ë¸”ë¡œ ì „ì†¡í•©ë‹ˆë‹¤. ì´ëŠ” í•˜ë“œì›¨ì–´ ë ˆë²¨ì—ì„œ ìˆ˜í–‰ë˜ë©°, ì»¤ë„ì˜ ê°œì… ì—†ì´ ì§ì ‘ ë©”ëª¨ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ì½ì–´ ì „ì†¡í•©ë‹ˆë‹¤. ì „ì†¡ ì™„ë£Œ í›„ í•˜ë“œì›¨ì–´ ì¸í„°ëŸ½íŠ¸ë¥¼ ë°œìƒì‹œì¼œ ì»¤ë„ì— ì•Œë¦½ë‹ˆë‹¤.',
      functions: ['DMA'], 
      position: { x: 1400, y: 200 } 
    },
    
    // Netfilter TX Hook ì„¸ë¶€
    { 
      id: 'nf:output', 
      label: 'OUTPUT', 
      level: 'NETFILTER', 
      desc: 'ë¡œì»¬ ìƒì„± íŒ¨í‚· ì²˜ë¦¬',
      detailedDesc: 'OUTPUT hookì€ ë¡œì»¬ ì‹œìŠ¤í…œì—ì„œ ìƒì„±ëœ íŒ¨í‚·ì— ëŒ€í•´ ì‹¤í–‰ë©ë‹ˆë‹¤. ë¼ìš°íŒ… ê²°ì • ì „ì— ì‹¤í–‰ë˜ë©°, ë¡œì»¬ì—ì„œ ìƒì„±ëœ íŒ¨í‚·ì— ëŒ€í•œ í•„í„°ë§ê³¼ NATë¥¼ ìˆ˜í–‰í•©ë‹ˆë‹¤. SNATì˜ ì´ˆê¸° ë‹¨ê³„ê°€ ì—¬ê¸°ì„œ ìˆ˜í–‰ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.',
      functions: ['ip_local_out()'], 
      parent: 'netfilter-tx-out', 
      position: { x: 350, y: 300 } 
    },
    { 
      id: 'nf:postrouting', 
      label: 'POSTROUTING', 
      level: 'NETFILTER', 
      desc: 'ë¼ìš°íŒ… í›„ ìµœì¢… ì²˜ë¦¬',
      detailedDesc: 'POSTROUTING hookì€ ë¼ìš°íŒ… ê²°ì • í›„, íŒ¨í‚·ì´ ë„¤íŠ¸ì›Œí¬ ì¸í„°í˜ì´ìŠ¤ë¡œ ë‚˜ê°€ê¸° ì§ì „ì— ì‹¤í–‰ë˜ëŠ” ë§ˆì§€ë§‰ hookì…ë‹ˆë‹¤. SNATì˜ ìµœì¢… ë‹¨ê³„ê°€ ì—¬ê¸°ì„œ ìˆ˜í–‰ë˜ë©°, íŒ¨í‚·ì˜ ì†ŒìŠ¤ ì£¼ì†Œê°€ ë³€ê²½ë©ë‹ˆë‹¤. ë˜í•œ ë§ˆì§€ë§‰ ë°©í™”ë²½ ì²´í¬ì™€ íŒ¨í‚· manglingì´ ìˆ˜í–‰ë©ë‹ˆë‹¤.',
      functions: ['ip_finish_output()'], 
      parent: 'netfilter-tx-post', 
      position: { x: 750, y: 300 } 
    }
  ],
  edges: [
    // RX ê²½ë¡œ
    { source: 'nic-rx', target: 'nic-rx-ring' },
    { source: 'nic-rx-ring', target: 'driver-rx' },
    { source: 'driver-rx', target: 'napi-rx' },
    { source: 'driver-rx', target: 'xdp-rx' },
    { source: 'xdp-rx', target: 'skb-rx' },
    { source: 'napi-rx', target: 'skb-rx' },
    { source: 'skb-rx', target: 'netfilter-rx' },
    { source: 'netfilter-rx', target: 'routing-rx' },
    { source: 'routing-rx', target: 'socket-rx' },
    { source: 'socket-rx', target: 'tcp-rx-buffer' },
    { source: 'socket-rx', target: 'socket-rx-queue' },
    { source: 'socket-rx-queue', target: 'user-rx' },
    
    // Netfilter Hook ì—°ê²° (RX)
    { source: 'netfilter-rx', target: 'nf:prerouting' },
    { source: 'nf:prerouting', target: 'routing-rx' },
    { source: 'routing-rx', target: 'nf:input' },
    { source: 'routing-rx', target: 'nf:forward' },
    { source: 'nf:input', target: 'socket-rx' },
    
    // TX ê²½ë¡œ
    { source: 'user-tx', target: 'socket-tx-queue' },
    { source: 'socket-tx-queue', target: 'socket-tx' },
    { source: 'socket-tx', target: 'tcp-tx' },
    { source: 'socket-tx', target: 'tcp-tx-buffer' },
    { source: 'tcp-tx-buffer', target: 'tcp-tx' },
    { source: 'tcp-tx', target: 'netfilter-tx-out' },
    { source: 'netfilter-tx-out', target: 'routing-tx' },
    { source: 'routing-tx', target: 'netfilter-tx-post' },
    { source: 'netfilter-tx-post', target: 'tc-tx' },
    { source: 'tc-tx', target: 'qdisc-queue' },
    { source: 'qdisc-queue', target: 'driver-tx' },
    { source: 'driver-tx', target: 'nic-tx-ring' },
    { source: 'nic-tx-ring', target: 'nic-tx' },
    
    // Netfilter Hook ì—°ê²° (TX)
    { source: 'netfilter-tx-out', target: 'nf:output' },
    { source: 'nf:output', target: 'routing-tx' },
    { source: 'routing-tx', target: 'nf:postrouting' },
    { source: 'nf:postrouting', target: 'tc-tx' }
  ]
};

// Cytoscape ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
const cy = cytoscape({
  container: document.getElementById('cy'),
  
  wheelSensitivity: 0.15,
  minZoom: 0.2,
  maxZoom: 4,
  panningEnabled: true,
  zoomingEnabled: true,
  
  style: [
    {
      selector: 'node',
      style: {
        'label': 'data(label)',
        'text-valign': 'center',
        'text-halign': 'center',
        'color': '#fff',
        'background-color': 'data(color)',
        'width': 140,
        'height': 60,
        'font-size': 13,
        'font-weight': 'bold',
        'shape': 'roundrectangle',
        'border-width': 2,
        'border-color': '#fff',
        'text-wrap': 'wrap',
        'text-max-width': 130
      }
    },
    {
      selector: 'edge',
      style: {
        'width': 3,
        'line-color': '#60a5fa',
        'target-arrow-color': '#60a5fa',
        'target-arrow-shape': 'triangle',
        'curve-style': 'bezier',
        'opacity': 0.7
      }
    },
    {
      selector: 'node[level = "HARDWARE"]',
      style: {
        'background-color': LEVEL_COLORS.HARDWARE
      }
    },
    {
      selector: 'node[level = "DRIVER"]',
      style: {
        'background-color': LEVEL_COLORS.DRIVER
      }
    },
    {
      selector: 'node[level = "KERNEL_LOW"]',
      style: {
        'background-color': LEVEL_COLORS.KERNEL_LOW
      }
    },
    {
      selector: 'node[level = "NETFILTER"]',
      style: {
        'background-color': LEVEL_COLORS.NETFILTER
      }
    },
    {
      selector: 'node[level = "ROUTING"]',
      style: {
        'background-color': LEVEL_COLORS.ROUTING
      }
    },
    {
      selector: 'node[level = "SOCKET"]',
      style: {
        'background-color': LEVEL_COLORS.SOCKET
      }
    },
    {
      selector: 'node[level = "XDP"]',
      style: {
        'background-color': LEVEL_COLORS.XDP
      }
    },
    {
      selector: 'node[level = "TC"]',
      style: {
        'background-color': LEVEL_COLORS.TC
      }
    },
    {
      selector: 'node[level = "BUFFER"]',
      style: {
        'background-color': LEVEL_COLORS.BUFFER
      }
    },
    {
      selector: 'node[level = "USER"]',
      style: {
        'background-color': LEVEL_COLORS.USER
      }
    }
  ],
  
  elements: {
    nodes: networkData.nodes.map(node => ({
      data: {
        id: node.id,
        label: node.label,
        level: node.level,
        desc: node.desc,
        detailedDesc: node.detailedDesc || '',
        functions: node.functions || [],
        color: LEVEL_COLORS[node.level] || '#666'
      },
      position: node.position,
      classes: node.parent ? 'detail-node' : 'main-node'
    })),
    edges: networkData.edges.map(edge => ({
      data: {
        source: edge.source,
        target: edge.target
      }
    }))
  },
  
  layout: {
    name: 'preset'
  }
});

// ì •ë³´ íŒ¨ë„ ì—…ë°ì´íŠ¸
const info = document.getElementById('info');
const zoomLevelDisplay = document.getElementById('zoom-level');

function updateInfoPanel(node) {
  const level = node.data('level');
  const levelNames = {
    'HARDWARE': 'í•˜ë“œì›¨ì–´',
    'DRIVER': 'ë“œë¼ì´ë²„',
    'KERNEL_LOW': 'ì»¤ë„ (ì €ìˆ˜ì¤€)',
    'NETFILTER': 'Netfilter',
    'ROUTING': 'ë¼ìš°íŒ…',
    'SOCKET': 'ì†Œì¼“',
    'XDP': 'XDP',
    'TC': 'íŠ¸ë˜í”½ ì œì–´',
    'BUFFER': 'ë²„í¼',
    'USER': 'ì‚¬ìš©ì ê³µê°„'
  };
  
  let html = `
    <h3>${node.data('label')}</h3>
    <p><span class="level-badge" style="background: ${node.data('color')}; color: #fff;">${levelNames[level] || level}</span></p>
    <p class="desc"><strong>${node.data('desc')}</strong></p>
  `;
  
  const detailedDesc = node.data('detailedDesc');
  if (detailedDesc) {
    html += `
      <div style="margin-top: 16px;">
        <p style="color: #9ca3af; line-height: 1.8; font-size: 14px;">${detailedDesc}</p>
      </div>
    `;
  }
  
  const functions = node.data('functions');
  if (functions && functions.length > 0) {
    html += `
      <div style="margin-top: 16px;">
        <p><strong style="color: #7dd3fc;">ì£¼ìš” í•¨ìˆ˜:</strong></p>
        <ul class="function-list">
          ${functions.map(fn => `<li>${fn}</li>`).join('')}
        </ul>
      </div>
    `;
  }
  
  info.innerHTML = html;
}

// ë…¸ë“œ í´ë¦­ ì´ë²¤íŠ¸
cy.on('tap', 'node', evt => {
  const node = evt.target;
  updateInfoPanel(node);
});

// Zoom ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
cy.on('zoom', () => {
  const z = cy.zoom();
  zoomLevelDisplay.textContent = `Zoom: ${z.toFixed(2)}x`;
  
  // ëª¨ë“  ë…¸ë“œëŠ” í•­ìƒ í‘œì‹œë¨ (ì¤Œ ë ˆë²¨ê³¼ ë¬´ê´€)
});

// í‚¤ë³´ë“œ ì´ë²¤íŠ¸
document.addEventListener('keydown', e => {
  const pan = cy.pan();
  const step = 80;
  const zoomStep = 0.2;

  switch (e.key) {
    case 'ArrowUp':
      cy.pan({ x: pan.x, y: pan.y + step });
      break;
    case 'ArrowDown':
      cy.pan({ x: pan.x, y: pan.y - step });
      break;
    case 'ArrowLeft':
      cy.pan({ x: pan.x + step, y: pan.y });
      break;
    case 'ArrowRight':
      cy.pan({ x: pan.x - step, y: pan.y });
      break;
    case '+':
    case '=':
      cy.zoom(cy.zoom() + zoomStep);
      break;
    case '-':
    case '_':
      cy.zoom(cy.zoom() - zoomStep);
      break;
    case 'Escape':
      cy.fit();
      break;
  }
});

// ì´ˆê¸° ì „ì²´ ë³´ê¸°
cy.ready(() => {
  cy.fit(50);
  zoomLevelDisplay.textContent = `Zoom: ${cy.zoom().toFixed(2)}x`;
});

// ë²”ë¡€ ì¶”ê°€
const legendHtml = `
  <div class="legend">
    <h3>ê³„ì¸µë³„ ìƒ‰ìƒ</h3>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.HARDWARE};"></div>
      <span>í•˜ë“œì›¨ì–´ (NIC)</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.DRIVER};"></div>
      <span>ë“œë¼ì´ë²„</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.KERNEL_LOW};"></div>
      <span>ì»¤ë„ ì €ìˆ˜ì¤€ (NAPI, skb)</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.XDP};"></div>
      <span>XDP</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.NETFILTER};"></div>
      <span>Netfilter</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.ROUTING};"></div>
      <span>ë¼ìš°íŒ…</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.SOCKET};"></div>
      <span>ì†Œì¼“</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.TC};"></div>
      <span>íŠ¸ë˜í”½ ì œì–´ (TC/qdisc)</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.BUFFER};"></div>
      <span>ë²„í¼ (Buffer/Queue)</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: ${LEVEL_COLORS.USER};"></div>
      <span>ì‚¬ìš©ì ê³µê°„ (User-space)</span>
    </div>
  </div>
`;

info.innerHTML += legendHtml;
</script>

</body>
</html>

